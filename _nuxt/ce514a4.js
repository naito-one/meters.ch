(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{181:function(t,e,n){"use strict";var r=n(5),o={props:{title:String,description:String,back:{type:Boolean,default:!0},url:{type:String,default:"/"}},methods:{goBack:function(t){t.preventDefault(),this.$router.push(this.url).catch(r.A)}}},l=n(13),component=Object(l.a)(o,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("header",{staticClass:"w-full flex items-center justify-center h-18"},[t.back?n("button",{staticClass:"z-20 clickable material-icons focus:shadow-outline hover:lighten-10 active:darken-10 absolute left-0 top-0 min-w-10 min-h-10 px-5 py-4 text-2xl",attrs:{title:t.$t("global.back")},on:{click:t.goBack}},[t._v("\n    arrow_back\n  ")]):n("img",{staticClass:"z-20 absolute left-0 top-0 w-10 mx-5 my-4 select-none",attrs:{src:"/images/naito-900.svg",alt:t.$t("alt.naito_one_logo")}}),t._v(" "),n("h1",{staticClass:"font-heading text-2xl",attrs:{title:t.description},domProps:{textContent:t._s(t.title)}})])}),[],!1,null,null,null);e.a=component.exports},186:function(t,e,n){"use strict";var r=n(187),o=n.n(r),l=(n(191),n(5));o.a.defaults.global.defaultFontSize=l.i.fontSize,o.a.defaults.global.defaultFontFamily=l.i.fontFamily,o.a.Legend.prototype.afterFit=function(){this.height=this.height+16},o.a.defaults.global.events.push("touchend"),o.a.Tooltip.prototype.handleEvent=function(t){var e,n=this,r=n._options;return n._lastActive=n._lastActive||[],"mouseout"===t.type||"touchend"===t.type?n._active=[]:n._active=n._chart.getElementsAtEventForMode(t,r.mode,r),(e=!o.a.helpers.arrayEquals(n._active,n._lastActive))&&(n._lastActive=n._active,(r.enabled||r.custom)&&(n._eventPosition={x:t.x,y:t.y},n.update(!0),n.pivot())),e};var c=o.a,h={name:"BasicChart",props:{title:{type:Object,default:function(){}},datasets:{type:Array,default:function(){return[]}},xAxes:{type:Array,default:function(){return[]}},yAxes:{type:Array,default:function(){return[]}},tooltipTitleCallback:{type:Function,default:void 0},tooltipLabelCallback:{type:Function,default:void 0},tooltipAfterBodyCallback:{type:Function,default:function(){return null}},tooltipBodyAlign:{type:String,default:"left"},tooltipsFilter:{type:Function,default:void 0},legend:{type:Boolean,default:!0},interactionMode:{type:String,default:"index"},waiting:{type:Boolean,default:!1},error:{type:Boolean,default:!1},errorMessage:{type:String,default:""}},data:function(){return{chart:null,defaultConfig:{type:"line",data:{datasets:[]},options:{title:this.title,spanGaps:!0,maintainAspectRatio:!1,animation:{duration:0,easing:"linear"},layout:{padding:{left:20,right:20,top:0,bottom:0}},legend:{position:"top",display:this.legend,labels:{padding:25,boxWidth:35,fontSize:l.i.fontSize,fontColor:l.i.fontColor,generateLabels:function(t){return Array.isArray(t.data.datasets)?t.data.datasets.map((function(e,i){return{text:e.label,fillStyle:e.borderColor,hidden:!t.isDatasetVisible(i),lineCap:e.borderCapStyle,lineDash:e.borderDash,lineDashOffset:e.borderDashOffset,lineJoin:e.borderJoinStyle,lineWidth:e.borderWidth,strokeStyle:e.borderColor,pointStyle:e.pointStyle,rotation:e.rotation,datasetIndex:i}})):[]}}},elements:{line:{tension:0},point:{radius:0}},scales:{xAxes:this.xAxes,yAxes:this.yAxes},hover:{mode:this.interactionMode,intersect:!1,animationDuration:0},tooltips:{mode:this.interactionMode,intersect:!1,xPadding:12,yPadding:16,bodySpacing:8,titleMarginBottom:18,caretSize:8,bodyAlign:this.tooltipBodyAlign,callbacks:{title:this.tooltipTitleCallback,label:this.tooltipLabelCallback,afterBody:this.tooltipAfterBodyCallback},filter:this.tooltipsFilter}}}}},watch:{title:{handler:function(t,e){this.chart.options.title=t,this.chart.update()},deep:!0},datasets:{handler:function(t,e){var n=JSON.stringify(t);this.chart.data.datasets=JSON.parse(n),this.chart.update()},deep:!0},xAxes:{handler:function(t,e){this.chart.options.scales.xAxes=t,this.chart.update()},deep:!0},yAxes:{handler:function(t,e){this.chart.options.scales.yAxes=t,this.chart.update()},deep:!0},legend:function(t,e){t!==e&&(this.chart.options.legend.display=t,this.chart.update())}},mounted:function(){this.chart=new c(this.$refs.canvas,this.defaultConfig),this.chart.data.datasets=JSON.parse(JSON.stringify(this.datasets)),this.chart.options.scales.xAxes=this.xAxes,this.chart.options.scales.yAxes=this.yAxes},beforeDestroy:function(){this.chart&&this.chart.destroy()},computed:{canvasClasses:function(){return["transition-opacity-100"].concat(this.error?"opacity-25":"opacity-1")},coverClasses:function(){return["absolute","top-0","flex","items-center","justify-center","w-full","h-full"]}}},d=n(13),component=Object(d.a)(h,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"relative min-w-0 w-full h-full select-none"},[n("canvas",{ref:"canvas",class:t.canvasClasses}),t._v(" "),n("div",{class:["transition-opacity-100"].concat(t.coverClasses).concat(t.error?["opacity-1","pointer-events-auto"]:["opacity-0","pointer-events-none"])},[n("span",{staticClass:"text-center font-medium",domProps:{textContent:t._s(t.errorMessage)}})]),t._v(" "),n("div",{class:["bg-gray-100","transition-opacity-400"].concat(t.coverClasses).concat(t.waiting?["opacity-1","pointer-events-auto"]:["opacity-0","pointer-events-none"])},[t._m(0)])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"lds-ring"},[e("div"),this._v(" "),e("div"),this._v(" "),e("div"),this._v(" "),e("div")])}],!1,null,null,null);e.a=component.exports},192:function(t,e,n){"use strict";n(54),n(20),n(14),n(41),n(10);var r=n(2),o=(n(36),n(37),n(27),n(4)),l=(n(182),n(11)),c=n(5),h=n(0);function d(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function f(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?d(Object(source),!0).forEach((function(e){Object(r.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):d(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var y={name:"SignatureChart",components:{BasicChart:n(186).a},props:{site:{type:Number,required:!0},temperature:{type:Number,required:!0},heater:{type:Number,required:!0},period:{type:Number,required:!0},offset:{type:Number,required:!0},filter:{type:Number,required:!0},highlight:{type:Number,required:!0},legend:{type:Boolean,default:!0}},data:function(){var t=this;return{agregation:0,hasData:!0,waiting:!0,datasets:[],consumptionByAverageTemp:null,symbol:"",title:{display:!0,text:"...",position:"left",font:{family:c.i.fontFamily,size:c.i.fontSize,weight:"normal"},padding:10},xAxes:[{type:"linear",gridLines:!1,ticks:{precision:2,maxTicksLimit:24,fontColor:c.i.fontColor,fontSize:c.i.fontSize,padding:18,callback:function(t){return"".concat(t," °C")}}}],yAxes:[{display:"auto",gridLines:!1,offset:!0,ticks:{precision:0,maxTicksLimit:7,fontColor:c.i.fontColor,fontSize:c.i.fontSize,padding:18}}],tooltipTitleCallback:function(e,data){if(0!==e.length){var n=e[0],r=Object(c.z)(t.agregation,t.period),o=data.datasets[n.datasetIndex].data[n.index].z;return"".concat(Object(c.g)(l.DateTime.fromISO(o).setLocale(t.$dateLocale()).toFormat(r)))}},tooltipLabelCallback:function(t,data){return null},tooltipAfterBodyCallback:function(e,data){if(0===e.length)return"";var n=e[0],r=n.xLabel.toLocaleString(t.$numberLocale(),c.n),o=Object(c.U)(n.yLabel),l=o.number.toLocaleString(t.$numberLocale(),c.n);return[t.$t("consumption_agregations.".concat(c.L[t.agregation])),"".concat(l," ").concat(o.unit+t.symbol),t.$t("pages.signature.download.avg_temp"),"".concat(r," °C")]},tooltipsFilter:function(t){return 2!==t.datasetIndex}}},methods:{updateRawData:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var r,o,h,d,f,y,m,v,x,w,A,D,k,$,O,_,C,S;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=l.DateTime.local(),o=Object(c.x)(r,e.period,e.offset),h={from:o.from,to:o.to.plus({millisecond:1})},d=e.$store.getters.site({site_id:e.site}),f=e.$store.getters.meteoLocation(d),n.next=7,e.$getMeteoReadings(f.id,o,t);case 7:return y=n.sent,n.next=10,e.$getReadings(e.temperature,o,t);case 10:return m=n.sent,n.next=13,e.$getReadings(e.heater,h,t);case 13:if(v=n.sent,0!==y.length&&0!==m.length&&0!==v.length){n.next=19;break}return e.datasets=[],e.hasData=!1,e.$emit("currentData",{datasets:[],hasData:e.hasData}),n.abrupt("return");case 19:if(x=e.period===c.S.week?c.e.hour:e.period===c.S.month?c.e.day:c.e.week,e.agregation=x,e.title.text=e.$t("consumption_agregations.".concat(c.L[e.agregation])),w=Object(c.d)(y.map(c.J),x,"avg"),A=Object(c.d)(m.map(c.J),x,"avg"),D=Object(c.d)(v.map(c.J),x,"sum"),k=w.length,$=A.length,O=D.length,!(k<=2||$<=2||O<=2)){n.next=33;break}return e.datasets=[],e.hasData=!1,e.$emit("currentData",{datasets:[],hasData:e.hasData}),n.abrupt("return");case 33:return _=[w,A,D],k===$&&$===O||(C=_.reduce((function(t,data){return data.length>t.length?data:t})),_.forEach((function(data,i){data.length!==C.length&&(_[i]=Object(c.t)(C,data))}))),S=Array.from(new Array(_[0].length),(function(t,i){return{x:_[1][i].x,y:+(_[1][i].y-_[0][i].y).toFixed(2)}})),e.consumptionByAverageTemp=Array.from(new Array(_[2].length),(function(t,i){return{x:S[i].y,y:_[2][i].y,z:_[2][i].x}})).filter((function(t){return!isNaN(t.x)})).sort((function(a,b){return a.x-b.x})),n.next=39,e.updateUserFilter();case 39:case"end":return n.stop()}}),n)})))()},updateUserFilter:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,r,o,l,h,d,y,m,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t.consumptionByAverageTemp){e.next=2;break}return e.abrupt("return");case 2:if(n=[],r=Object(c.F)(t.consumptionByAverageTemp,t.filter),o=Object(c.F)(r.cleanData,t.highlight),l=Object(c.y)(o.cleanData),h=l.slope,d=l.intercept,y=[!1,!1,!1],3===t.datasets.length&&null!==t.$refs.chart.chart)try{y=y.map((function(e,i){return!t.$refs.chart.chart.isDatasetVisible(i)}))}catch(t){}n.push(f({label:t.$t("pages.signature.chart.avg_clean"),type:"scatter",data:o.cleanData,yAxisID:0,hidden:y[0]},c.k)),n.push(f({label:t.$t("pages.signature.chart.avg_noisy"),type:"scatter",data:o.noisyData,yAxisID:0,hidden:y[1]},c.G)),m=t.consumptionByAverageTemp[0].x,v=t.consumptionByAverageTemp[t.consumptionByAverageTemp.length-1].x,n.push(f({label:t.$t("pages.signature.chart.ideal_line"),data:[{x:m,y:h*m+d},{x:v,y:h*v+d}],yAxisID:0,hidden:y[2]},c.B)),t.datasets=n,t.hasData=!0,t.$emit("currentData",{datasets:n,hasData:t.hasData});case 16:case"end":return e.stop()}}),e)})))()},reTranslate:function(){this.title.text=this.$t("consumption_agregations.".concat(c.L[this.agregation])),3===this.datasets.length&&(this.$set(this.datasets[0],"label",this.$t("pages.signature.chart.avg_clean")),this.$set(this.datasets[1],"label",this.$t("pages.signature.chart.avg_noisy")),this.$set(this.datasets[2],"label",this.$t("pages.signature.chart.ideal_line")))},hideYTicks:function(){var t=this;this.yAxes.forEach((function(e){t.$set(e.ticks,"display",!1)}))},showYTicks:function(){var t=this;this.yAxes.forEach((function(e){t.$set(e.ticks,"display",!0)}))},updateAxes:function(){if(this.$store.getters.hasResourceTypes){var t=this.$store.getters.resourceType(this.$store.state.dataById.resources[this.heater]);this.symbol=t.symbol,this.yAxes=[Object(c.T)(t.symbol,"left",!1,!0)],this.$store.getters.smallScreen&&this.hideYTicks()}},waitForData:function(){var t=this,e=[];return this.$store.getters.hasMeteoLocations||e.push(h.t),this.$store.getters.hasSites||e.push(h.C),this.$store.getters.hasResourceTypes||e.push(h.y),0===e.length?(this.waiting=!1,Promise.resolve()):(this.waiting=!0,Object(c.V)(this.$store,e).then((function(){t.waiting=!1})))},forceUpdate:function(){var t=this;return this.waitForData().then((function(){t.waiting=!0,t.updateAxes(),t.updateRawData(!0).then((function(){return t.waiting=!1}),console.error)}))}},watch:{site:function(t,e){var n=this;t!==e&&this.isQueryValid&&this.waitForData().then((function(){n.waiting=!0,n.updateRawData().then((function(){return n.waiting=!1}),console.error)}))},temperature:function(t,e){var n=this;t!==e&&this.isQueryValid&&this.waitForData().then((function(){n.waiting=!0,n.updateRawData().then((function(){return n.waiting=!1}),console.error)}))},heater:function(t,e){var n=this;t!==e&&this.isQueryValid&&this.waitForData().then((function(){n.waiting=!0,n.updateAxes(),n.updateRawData().then((function(){return n.waiting=!1}),console.error)}))},period:function(t,e){var n=this;t!==e&&this.isQueryValid&&this.waitForData().then((function(){n.waiting=!0,n.updateRawData().then((function(){return n.waiting=!1}),console.error)}))},offset:function(t,e){var n=this;t!==e&&this.isQueryValid&&this.waitForData().then((function(){n.waiting=!0,n.updateRawData().then((function(){return n.waiting=!1}),console.error)}))},filter:function(t,e){var n=this;t!==e&&this.isQueryValid&&(this.waiting=!0,this.updateUserFilter().then((function(){return n.waiting=!1})))},highlight:function(t,e){var n=this;t!==e&&this.isQueryValid&&(this.waiting=!0,this.updateUserFilter().then((function(){return n.waiting=!1})))},locale:function(t,e){t!==e&&this.reTranslate()}},mounted:function(){var t=this;this.isQueryValid&&this.waitForData().then((function(){t.waiting=!0,t.updateAxes(),t.updateRawData().then((function(){return t.waiting=!1}),console.error)})),this.$store.getters.smallScreen?this.hideYTicks():this.showYTicks(),this.$store.subscribe((function(e){e.type===h.D&&(t.$store.getters.smallScreen?t.hideYTicks():t.showYTicks())}))},computed:{periodOffsetString:function(){return this.$tc("period_offsets."+c.M[this.period],this.offset,{count:this.offset})},locale:function(){return this.$store.state.locale},resourceTypes:function(){return this.$store.state.data.resourceTypes},isQueryValid:function(){return-1!==this.site&&-1!==this.temperature&&-1!==this.heater}}},m=n(13),component=Object(m.a)(y,(function(){var t=this,e=t.$createElement;return(t._self._c||e)("basic-chart",{ref:"chart",attrs:{title:t.title,datasets:t.datasets,"x-axes":t.xAxes,"y-axes":t.yAxes,"tooltip-title-callback":t.tooltipTitleCallback,"tooltip-label-callback":t.tooltipLabelCallback,"tooltip-after-body-callback":t.tooltipAfterBodyCallback,"tooltip-body-align":"center","tooltips-filter":t.tooltipsFilter,legend:t.legend,"interaction-mode":"nearest",waiting:t.waiting,error:!t.hasData,"error-message":t.$t("global.not_enough_data",{period:t.periodOffsetString})}})}),[],!1,null,null,null);e.a=component.exports}}]);