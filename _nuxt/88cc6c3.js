(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{181:function(t,e,r){"use strict";var n=r(5),o={props:{title:String,description:String,back:{type:Boolean,default:!0},url:{type:String,default:"/"}},methods:{goBack:function(t){t.preventDefault(),this.$router.push(this.url).catch(n.A)}}},c=r(13),component=Object(c.a)(o,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("header",{staticClass:"w-full flex items-center justify-center h-18"},[t.back?r("button",{staticClass:"z-20 clickable material-icons focus:shadow-outline hover:lighten-10 active:darken-10 absolute left-0 top-0 min-w-10 min-h-10 px-5 py-4 text-2xl",attrs:{title:t.$t("global.back")},on:{click:t.goBack}},[t._v("\n    arrow_back\n  ")]):r("img",{staticClass:"z-20 absolute left-0 top-0 w-10 mx-5 my-4 select-none",attrs:{src:"/images/naito-900.svg",alt:t.$t("alt.naito_one_logo")}}),t._v(" "),r("h1",{staticClass:"font-heading text-2xl",attrs:{title:t.description},domProps:{textContent:t._s(t.title)}})])}),[],!1,null,null,null);e.a=component.exports},185:function(t,e,r){"use strict";r(14),r(38),r(20),r(36),r(37),r(28),r(29),r(10),r(122),r(65),r(19),r(182);var n=r(5);function o(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,h=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return l=t.done,t},e:function(t){h=!0,o=t},f:function(){try{l||null==r.return||r.return()}finally{if(h)throw o}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}var l={name:"SearchSelect",props:{name:{type:String,required:!0},placeholder:{type:String,default:""},options:{type:Array,default:function(){return[]}},value:{type:Number,default:-1},top:{type:Boolean,default:!1},single:{type:Boolean,default:!1}},data:function(){return{searchString:"",showOptions:!1,currentValue:-1,supposedSearchString:"",mousedownListener:null}},watch:{value:function(t){if(t!==this.currentValue){var option=this.getOptionById(t);this.searchString=option?option.value:"",this.supposedSearchString=this.searchString,this.showOptions=!1,this.currentValue=t}},options:function(t,e){if(0!==e.length){if(t.length===e.length&&-1!==this.currentValue)return this.searchString=this.getOptionById(this.currentValue).value,void(this.supposedSearchString=this.searchString);this.searchString="",this.supposedSearchString=this.searchString,this.currentValue=-1,this.$emit("input",-1)}}},mounted:function(){var t=this;this.mousedownListener=function(){t.showOptions&&(t.showOptions=!1,t.searchString=t.supposedSearchString)},document.addEventListener("mousedown",this.mousedownListener,{passive:!0})},beforeDestroy:function(){this.mousedownListener&&document.removeEventListener("mousedown",this.mousedownListener)},methods:{getOptionById:function(t){var e,r=o(this.options);try{for(r.s();!(e=r.n()).done;){var option=e.value;if(option.id===t)return option}}catch(t){r.e(t)}finally{r.f()}return null},keepShown:function(t){this.showOptions&&t.stopPropagation()},show:function(t){this.showOptions||(this.showOptions=!0,this.top&&Object(n.O)(this.$refs.scrollDiv))},checkForTab:function(t){var e=this;9===t.keyCode&&setTimeout((function(){e.$refs.focusRoot.contains(document.activeElement)||(e.showOptions=!1,e.searchString=e.supposedSearchString)}),0)},clear:function(){this.searchString="",this.supposedSearchString=this.searchString,this.currentValue=-1,this.$emit("input",-1),this.$refs.focusRoot.getElementsByTagName("input")[0].focus()},clickedOption:function(option){this.searchString=option.value,this.supposedSearchString=this.searchString,this.showOptions=!1,this.currentValue=option.id,this.$emit("input",option.id)}},computed:{inputName:function(){return"search-select-"+this.name},filteredOptions:function(){var t=this;return""===this.searchString?this.options.sort((function(a,b){return a.value.localeCompare(b.value)})):this.options.filter((function(option){return-1!==option.value.search(new RegExp(t.searchString,"gi"))})).sort((function(a,b){return a.value.localeCompare(b.value)}))},optionsClasses:function(){return["absolute","bg-gray-200","shadow-md","w-full","transition-opacity-100","flex"].concat(this.showOptions?["opacity-1","pointer-events-auto"]:["opacity-0","pointer-events-none"]).concat(this.top?["flex-col-reverse","bottom-full","rounded-t-md"]:["flex-col","rounded-b-md"])},optionsUlClasses:function(){return["flex"].concat(this.top?["flex-col-reverse"]:["flex-col"])}}},h=r(13),component=Object(h.a)(l,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{ref:"focusRoot",staticClass:"relative z-10",on:{mousedown:t.keepShown}},[r("div",{class:"w-full flex items-center text-gray-900 relative "+(t.single?"wrapped-single-transparent-input":"wrapped-transparent-input")},[r("label",{staticClass:"material-icons py-2 pl-2 clickable",attrs:{for:t.inputName}},[t._v("search")]),t._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:t.searchString,expression:"searchString"}],staticClass:"flex-grow px-4 py-2",attrs:{placeholder:t.placeholder,type:"text",name:t.inputName,id:t.inputName},domProps:{value:t.searchString},on:{focus:t.show,keydown:t.checkForTab,input:function(e){e.target.composing||(t.searchString=e.target.value)}}}),t._v(" "),""!==t.searchString?r("i",{staticClass:"material-icons py-2 pr-2 clickable text-gray-800",on:{click:t.clear}},[t._v("backspace")]):t._e(),t._v(" "),r("div",{staticClass:"wrapped-style top-0 left-0 w-full h-full pointer-events-none absolute"})]),t._v(" "),r("div",{class:t.optionsClasses},[r("div",{ref:"scrollDiv",staticClass:"max-h-32 lg:max-h-64 overflow-y-auto"},[r("ul",{class:t.optionsUlClasses},[t._l(t.filteredOptions,(function(option){return r("li",{key:option.id,staticClass:"flex-grow flex"},[r("button",{staticClass:"p-4 w-full hover:bg-gray-100",attrs:{tabindex:t.showOptions?0:-1},domProps:{textContent:t._s(option.value)},on:{click:function(e){return t.clickedOption(option)},keydown:t.checkForTab}})])})),t._v(" "),0===t.filteredOptions.length?r("li",{staticClass:"flex-grow p-4",domProps:{textContent:t._s(t.$t("global.no_results"))}}):t._e()],2)])])])}),[],!1,null,null,null);e.a=component.exports},200:function(t,e,r){"use strict";r.r(e);r(38),r(20),r(37),r(19),r(28),r(29),r(66),r(14),r(10),r(36),r(27);var n=r(4),o=r(181),c=r(5),l={props:{resource:{type:Object,default:null}},computed:{site:function(){return this.$store.getters.site(this.$store.getters.sensor(this.resource))},resourceType:function(){return this.$store.getters.resourceType(this.resource)},formattedResource:function(){return null===this.resource?"":Object(c.u)(this.$i18n,this.resource,this.resourceType,this.site)},location:function(){return null===this.resource?"":this.resource.lat&&this.resource.lon?"".concat(this.resource.location," (").concat(this.resource.lat,", ").concat(this.resource.lon,")"):this.resource.location}}},h=r(13),f=Object(h.a)(l,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"hidden"},[r("div",{staticClass:"flex flex-col items-center text-base p-2"},[r("h2",{staticClass:"text-lg font-bold mb-2 text-center",domProps:{textContent:t._s(t.formattedResource)}}),t._v(" "),r("span",{domProps:{textContent:t._s(t.location)}}),t._v(" "),t.resource&&t.resource.meter?r("span",{domProps:{textContent:t._s(t.$t("pages.map.meter")+": "+t.resource.meter)}}):t._e(),t._v(" "),r("button",{staticClass:"open-chart mt-2 action bg-naito-green-200 text-gray-100 text-center",domProps:{textContent:t._s(t.$t("pages.index.open_chart"))}})])])}),[],!1,null,null,null).exports,m=r(185),d=r(193);function v(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return y(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return y(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return c=t.done,t},e:function(t){l=!0,o=t},f:function(){try{c||null==r.return||r.return()}finally{if(l)throw o}}}}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}delete d.Icon.Default.prototype._getIconUrl,d.Icon.Default.mergeOptions({iconRetinaUrl:r(194),iconUrl:r(195),shadowUrl:r(196)});var x={middleware:"needs-auth",head:function(){return{title:"".concat(this.$t("pages.map.title")," - Meters"),htmlAttrs:{lang:this.$store.state.locale},meta:[{hid:"description",name:"description",content:this.$t("pages.map.description")}]}},components:{AppHeader:o.a,MapPopup:f,SearchSelect:m.a},data:function(){return{map:null,markers:[],activeResource:null,currentX:46.8246,currentY:8.2245,currentZ:9,minZ:9,maxZ:19,minX:45.8126,maxX:47.8092,minY:5.9445,maxY:10.5079,currentSearch:-1,hadQuery:!1}},mounted:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n,o,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.getQuery(),t.setQuery(),t.map=d.map(t.$refs.map,{zoomControl:!1,center:[t.currentX,t.currentY],zoom:t.currentZ,maxBounds:[[t.minX,t.minY],[t.maxX,t.maxY]],maxBoundsViscosity:1,minZoom:t.minZ,maxZoom:t.maxZ}),d.tileLayer("\thttps://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Base map and data from OpenStreetMap and OpenStreetMap Foundation <a ref="noreferer" target="_blank" href="https://www.openstreetmap.org/copyright">&copy; OpenStreetMap contributors</a>',maxZoom:t.maxZ,tileSize:256}).addTo(t.map),t.map.on("zoomend",(function(){t.currentZ=t.map.getZoom(),t.setQuery()})),t.map.on("moveend",(function(){var e=t.map.getCenter();t.currentX=+e.lat.toFixed(4),t.currentY=+e.lng.toFixed(4),t.setQuery()})),e.next=8,Promise.all([t.$getResources(),t.$getResourceTypes(),t.$getSensors(),t.$getSites(),t.$getUser()]);case 8:r=v(t.resources);try{for(o=function(){var e=n.value,r=[e.lat,e.lon];t.markers.push(d.marker(r).on("click",(function(n){t.activeResource=e,t.$nextTick((function(){var content=t.$refs.mapPopup.$el.firstElementChild.cloneNode(!0);content.querySelector(".open-chart").onclick=function(){t.$router.push({name:"explore",query:{resources:e.id}}).catch(c.A)},d.popup({offset:[0,-35]}).setLatLng(r).setContent(content).openOn(t.map)}))})).addTo(t.map))},r.s();!(n=r.n()).done;)o()}catch(t){r.e(t)}finally{r.f()}l=d.featureGroup(t.markers),t.homeBounds=l.getBounds().pad(.1),t.markers.length>0&&!t.hadQuery&&t.map.fitBounds(t.homeBounds);case 13:case"end":return e.stop()}}),e)})))()},methods:{setQuery:function(){var t={path:Object(c.K)(this.$route.path),query:{x:this.currentX,y:this.currentY,z:this.currentZ}};JSON.stringify(t.query)!==JSON.stringify(this.$route.query)&&this.$router.replace(t).catch(c.A)},getQuery:function(){var t=this.$route.query,e=parseFloat(t.x);isNaN(e)||(this.currentX=+Object(c.j)(e,this.minX,this.maxX).toFixed(4),this.hadQuery=!0);var r=parseFloat(t.y);isNaN(r)||(this.currentY=+Object(c.j)(r,this.minY,this.maxY).toFixed(4),this.hadQuery=!0);var n=parseInt(t.z);isNaN(n)||(this.currentZ=Object(c.j)(n,this.minZ,this.maxZ),this.hadQuery=!0)},resetView:function(){this.markers.length>0&&this.map.fitBounds(this.homeBounds)}},watch:{currentSearch:function(t){var e=this;if(-1!==t){var r=this.$store.getters.resource({resource_id:t});this.map.setView([r.lat,r.lon],this.maxZ),this.$nextTick((function(){e.currentSearch=-1}))}}},computed:{resources:function(){return this.$store.getters.resources.filter((function(t){return t.lat&&t.lon}))},formattedResources:function(){var t=this;return this.resources.map((function(e){var r=t.$store.getters.resourceType(e),n=t.$store.getters.sensor(e),o=t.$store.getters.site(n);return{id:e.id,value:Object(c.u)(t.$i18n,e,r,o)}}))}}},w=Object(h.a)(x,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("link",{attrs:{rel:"stylesheet",href:"leaflet.css"}}),t._v(" "),r("app-header",{attrs:{title:t.$t("pages.map.title"),description:t.$t("pages.map.description"),back:!0}}),t._v(" "),r("div",{ref:"map",staticClass:"w-full h-screen-36"}),t._v(" "),r("map-popup",{ref:"mapPopup",attrs:{resource:t.activeResource}}),t._v(" "),r("section",{staticClass:"absolute bottom-0 inset-x-0 w-full p-4 md:px-1/5 lg:px-1/4 xl:px-1/3 bg-naito-green-200 shadow-lg-top z-above-map flex"},[r("button",{staticClass:"w-10 h-10 bg-gray-100 rounded-md simple-action",attrs:{title:t.$t("pages.map.home"),"aria-label":t.$t("pages.map.home")},on:{click:t.resetView}},[r("i",{staticClass:"material-icons text-lg text-gray-800"},[t._v("home")])]),t._v(" "),r("search-select",{staticClass:"flex-grow ml-2",attrs:{name:"resource",placeholder:t.$t("pages.objectives.form.find_resource"),options:t.formattedResources,top:!0,single:!0},model:{value:t.currentSearch,callback:function(e){t.currentSearch=e},expression:"currentSearch"}})],1)],1)}),[],!1,null,null,null);e.default=w.exports}}]);