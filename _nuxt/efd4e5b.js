(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{181:function(t,e,o){"use strict";var n=o(5),r={props:{title:String,description:String,back:{type:Boolean,default:!0},url:{type:String,default:"/"}},methods:{goBack:function(t){t.preventDefault(),this.$router.push(this.url).catch(n.A)}}},c=o(13),component=Object(c.a)(r,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("header",{staticClass:"w-full flex items-center justify-center h-18"},[t.back?o("button",{staticClass:"z-20 clickable material-icons focus:shadow-outline hover:lighten-10 active:darken-10 absolute left-0 top-0 min-w-10 min-h-10 px-5 py-4 text-2xl",attrs:{title:t.$t("global.back")},on:{click:t.goBack}},[t._v("\n    arrow_back\n  ")]):o("img",{staticClass:"z-20 absolute left-0 top-0 w-10 mx-5 my-4 select-none",attrs:{src:"/images/naito-900.svg",alt:t.$t("alt.naito_one_logo")}}),t._v(" "),o("h1",{staticClass:"font-heading text-2xl",attrs:{title:t.description},domProps:{textContent:t._s(t.title)}})])}),[],!1,null,null,null);e.a=component.exports},186:function(t,e,o){"use strict";var n=o(187),r=o.n(n),c=(o(191),o(5));r.a.defaults.global.defaultFontSize=c.i.fontSize,r.a.defaults.global.defaultFontFamily=c.i.fontFamily,r.a.Legend.prototype.afterFit=function(){this.height=this.height+16},r.a.defaults.global.events.push("touchend"),r.a.Tooltip.prototype.handleEvent=function(t){var e,o=this,n=o._options;return o._lastActive=o._lastActive||[],"mouseout"===t.type||"touchend"===t.type?o._active=[]:o._active=o._chart.getElementsAtEventForMode(t,n.mode,n),(e=!r.a.helpers.arrayEquals(o._active,o._lastActive))&&(o._lastActive=o._active,(n.enabled||n.custom)&&(o._eventPosition={x:t.x,y:t.y},o.update(!0),o.pivot())),e};var l=r.a,d={name:"BasicChart",props:{title:{type:Object,default:function(){}},datasets:{type:Array,default:function(){return[]}},xAxes:{type:Array,default:function(){return[]}},yAxes:{type:Array,default:function(){return[]}},tooltipTitleCallback:{type:Function,default:void 0},tooltipLabelCallback:{type:Function,default:void 0},tooltipAfterBodyCallback:{type:Function,default:function(){return null}},tooltipBodyAlign:{type:String,default:"left"},tooltipsFilter:{type:Function,default:void 0},legend:{type:Boolean,default:!0},interactionMode:{type:String,default:"index"},waiting:{type:Boolean,default:!1},error:{type:Boolean,default:!1},errorMessage:{type:String,default:""}},data:function(){return{chart:null,defaultConfig:{type:"line",data:{datasets:[]},options:{title:this.title,spanGaps:!0,maintainAspectRatio:!1,animation:{duration:0,easing:"linear"},layout:{padding:{left:20,right:20,top:0,bottom:0}},legend:{position:"top",display:this.legend,labels:{padding:25,boxWidth:35,fontSize:c.i.fontSize,fontColor:c.i.fontColor,generateLabels:function(t){return Array.isArray(t.data.datasets)?t.data.datasets.map((function(e,i){return{text:e.label,fillStyle:e.borderColor,hidden:!t.isDatasetVisible(i),lineCap:e.borderCapStyle,lineDash:e.borderDash,lineDashOffset:e.borderDashOffset,lineJoin:e.borderJoinStyle,lineWidth:e.borderWidth,strokeStyle:e.borderColor,pointStyle:e.pointStyle,rotation:e.rotation,datasetIndex:i}})):[]}}},elements:{line:{tension:0},point:{radius:0}},scales:{xAxes:this.xAxes,yAxes:this.yAxes},hover:{mode:this.interactionMode,intersect:!1,animationDuration:0},tooltips:{mode:this.interactionMode,intersect:!1,xPadding:12,yPadding:16,bodySpacing:8,titleMarginBottom:18,caretSize:8,bodyAlign:this.tooltipBodyAlign,callbacks:{title:this.tooltipTitleCallback,label:this.tooltipLabelCallback,afterBody:this.tooltipAfterBodyCallback},filter:this.tooltipsFilter}}}}},watch:{title:{handler:function(t,e){this.chart.options.title=t,this.chart.update()},deep:!0},datasets:{handler:function(t,e){var o=JSON.stringify(t);this.chart.data.datasets=JSON.parse(o),this.chart.update()},deep:!0},xAxes:{handler:function(t,e){this.chart.options.scales.xAxes=t,this.chart.update()},deep:!0},yAxes:{handler:function(t,e){this.chart.options.scales.yAxes=t,this.chart.update()},deep:!0},legend:function(t,e){t!==e&&(this.chart.options.legend.display=t,this.chart.update())}},mounted:function(){this.chart=new l(this.$refs.canvas,this.defaultConfig),this.chart.data.datasets=JSON.parse(JSON.stringify(this.datasets)),this.chart.options.scales.xAxes=this.xAxes,this.chart.options.scales.yAxes=this.yAxes},beforeDestroy:function(){this.chart&&this.chart.destroy()},computed:{canvasClasses:function(){return["transition-opacity-100"].concat(this.error?"opacity-25":"opacity-1")},coverClasses:function(){return["absolute","top-0","flex","items-center","justify-center","w-full","h-full"]}}},f=o(13),component=Object(f.a)(d,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"relative min-w-0 w-full h-full select-none"},[o("canvas",{ref:"canvas",class:t.canvasClasses}),t._v(" "),o("div",{class:["transition-opacity-100"].concat(t.coverClasses).concat(t.error?["opacity-1","pointer-events-auto"]:["opacity-0","pointer-events-none"])},[o("span",{staticClass:"text-center font-medium",domProps:{textContent:t._s(t.errorMessage)}})]),t._v(" "),o("div",{class:["bg-gray-100","transition-opacity-400"].concat(t.coverClasses).concat(t.waiting?["opacity-1","pointer-events-auto"]:["opacity-0","pointer-events-none"])},[t._m(0)])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"lds-ring"},[e("div"),this._v(" "),e("div"),this._v(" "),e("div"),this._v(" "),e("div")])}],!1,null,null,null);e.a=component.exports},188:function(t,e,o){"use strict";o(54),o(20),o(41),o(14),o(10);var n=o(2),r=(o(27),o(4)),c=(o(182),o(11)),l=o(5),d=o(0);function f(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(object);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,o)}return e}function h(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(Object(source),!0).forEach((function(e){Object(n.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):f(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var m={name:"ExploreChart",components:{BasicChart:o(186).a},props:{period:{type:Number,required:!0},agregation:{type:Number,required:!0},offset:{type:Number,required:!0},resources:{type:Array,default:function(){return[]}},legend:{type:Boolean,default:!0}},data:function(){var t=this;return{previousResources:null,rawData:null,hasData:!0,waiting:!0,datasets:[],xAxes:[{type:"time",time:{unit:l.L[this.agregation],round:l.L[this.agregation],displayFormats:{hour:"HH:mm",week:"dd LLL yyyy",day:"dd LLL",month:"LLL yyyy"}},adapters:{date:{locale:this.$dateLocale()}},gridLines:!1,ticks:{fontColor:l.i.fontColor,fontSize:l.i.fontSize,padding:18}}],yAxes:[{display:"auto",gridLines:!1,offset:!0,ticks:{precision:0,maxTicksLimit:7,fontColor:l.i.fontColor,fontSize:l.i.fontSize,padding:18}}],tooltipTitleCallback:function(e,data){var o=Object(l.z)(t.agregation,t.period);return Object(l.g)(c.DateTime.fromISO(e[0].label).setLocale(t.$dateLocale()).toFormat(o))},tooltipLabelCallback:function(e,data){var label=data.datasets[e.datasetIndex].resource.description,symbol=data.datasets[e.datasetIndex].resourceType.symbol,o=parseFloat(e.value);if("Â°C"!==symbol){var n=Object(l.U)(o);return"  ".concat(label,": ").concat(n.number.toLocaleString(t.$numberLocale(),l.n)," ").concat(n.unit+symbol)}var r=o.toLocaleString(t.$numberLocale(),l.n);return"  ".concat(label,": ").concat(r," ").concat(symbol)}}},methods:{updateRawData:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function o(){var n,r,d,f,i,m,v,y,data,x,w;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:n=c.DateTime.local(),r=Object(l.x)(n,e.period,e.offset),d={from:r.from,to:r.to.plus({millisecond:1})},e.rawData=null,f=[],o.t0=regeneratorRuntime.keys(e.resources);case 6:if((o.t1=o.t0()).done){o.next=19;break}return i=o.t1.value,m=e.$store.getters.resource({resource_id:e.resources[i]}),v=e.$store.getters.resourceType(m),y=v&&"sum"===v.aggregation_function,o.next=13,e.$getReadings(e.resources[i],y?d:r,t);case 13:data=o.sent,x=null,e.$store.getters.numSites>1&&(w=e.$store.getters.sensor(m),x=e.$store.getters.site(w)),f.push(h({label:Object(l.u)(e.$i18n,m,v,x),data:data.map(l.J),yAxisID:1===e.yAxes.length?0:v.symbol,resource:m,resourceType:v,site:x},l.l[i%l.l.length])),o.next=6;break;case 19:return e.rawData=f,o.next=22,e.updateAgregation();case 22:case"end":return o.stop()}}),o)})))()},updateAgregation:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var o,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t.rawData&&0!==t.rawData.length){e.next=2;break}return e.abrupt("return");case 2:o=t.rawData.map((function(e){if(!e.resourceType)return e;var data=Object(l.d)(e.data,t.agregation,e.resourceType.aggregation_function);return h(h({},e),{},{data:data,pointRadius:1===data.length?4:0})})),n=o.reduce((function(t,e){return e.data.length>t.data.length?e:t})),r=o.map((function(t){return t===n?t:h(h({},t),{},{data:Object(l.t)(n.data,t.data)})})),t.xAxes[0].time.unit=l.L[t.agregation],t.xAxes[0].time.round=l.L[t.agregation],t.datasets=r,t.hasData=t.datasets.length>0&&t.datasets.some((function(t){return t.data.length>0})),t.$emit("currentData",{datasets:r,hasData:t.hasData});case 10:case"end":return e.stop()}}),e)})))()},reTranslate:function(){var t=this;this.datasets.forEach((function(e){t.$set(e,"label",Object(l.u)(t.$i18n,e.resource,e.resourceType,e.site))})),this.$set(this.xAxes[0].adapters.date,"locale",this.$dateLocale())},hideYTicks:function(){var t=this;this.yAxes.forEach((function(e){t.$set(e.ticks,"display",!1)}))},showYTicks:function(){var t=this;this.yAxes.forEach((function(e){t.$set(e.ticks,"display",!0)}))},updateAxes:function(){var t=this;this.resourceTypes&&(this.yAxes=this.resourceTypes.map((function(t){return t.symbol})).filter((function(symbol,i,t){return t.indexOf(symbol)===i})).map((function(symbol,i){return Object(l.T)(symbol,0===i?"right":"left","Â°C"!==symbol,"Â°C"!==symbol,symbol,i)})),this.datasets.forEach((function(e){t.$set(e,"yAxisID",e.resourceType.symbol)})),this.$store.getters.smallScreen&&this.hideYTicks())},waitForData:function(){var t=this,e=[];return this.$store.getters.hasResources||e.push(d.x),this.$store.getters.hasResourceTypes||e.push(d.y),0===e.length?(this.waiting=!1,Promise.resolve()):(this.waiting=!0,Object(l.V)(this.$store,e).then((function(){t.waiting=!1})))},forceUpdate:function(){var t=this;return this.waitForData().then((function(){t.waiting=!0,t.updateAxes(),t.updateRawData(!0).then((function(){return t.waiting=!1}),console.error)}))}},watch:{period:function(t,e){var o=this;t!==e&&this.waitForData().then((function(){o.waiting=!0,o.updateRawData().then((function(){return o.waiting=!1}),console.error)}))},offset:function(t,e){var o=this;t!==e&&this.waitForData().then((function(){o.waiting=!0,o.updateRawData().then((function(){return o.waiting=!1}),console.error)}))},resources:function(t){var e=this;this.previousResources&&JSON.stringify(t)===this.previousResources||(this.previousResources=JSON.stringify(t),this.waitForData().then((function(){e.waiting=!0,e.updateRawData().then((function(){return e.waiting=!1}),console.error)})))},agregation:function(t,e){var o=this;t!==e&&(this.waiting=!0,this.updateAgregation().then((function(){return o.waiting=!1})))},locale:function(t,e){t!==e&&this.reTranslate()},resourceTypes:function(){this.updateAxes()}},mounted:function(){var t=this;this.waitForData().then((function(){t.waiting=!0,t.updateAxes(),t.updateRawData().then((function(){return t.waiting=!1}),console.error)})),this.$store.getters.smallScreen?this.hideYTicks():this.showYTicks(),this.$store.subscribe((function(e){e.type===d.D&&(t.$store.getters.smallScreen?t.hideYTicks():t.showYTicks())}))},computed:{periodOffsetString:function(){return this.$tc("period_offsets."+l.M[this.period],this.offset,{count:this.offset})},locale:function(){return this.$store.state.locale},resourceTypes:function(){return this.$store.state.data.resourceTypes}}},v=o(13),component=Object(v.a)(m,(function(){var t=this,e=t.$createElement;return(t._self._c||e)("basic-chart",{attrs:{datasets:t.datasets,"x-axes":t.xAxes,"y-axes":t.yAxes,"tooltip-title-callback":t.tooltipTitleCallback,"tooltip-label-callback":t.tooltipLabelCallback,legend:t.legend,waiting:t.waiting,error:!t.hasData,"error-message":t.$t("global.no_data",{period:t.periodOffsetString})}})}),[],!1,null,null,null);e.a=component.exports},189:function(t,e,o){"use strict";o(19);var n=o(5),r={name:"BookmarkPopup",props:{show:Boolean,periodOffsetString:String,defaultChartName:{type:String,default:""}},data:function(){return{name:""}},watch:{show:function(t){t&&(Object(n.P)(this.$refs.scrollZone),this.name="")}},methods:{cancelOnBack:function(t){t.target===this.$refs.back&&this.$emit("cancel")},cancel:function(){this.$emit("cancel")},confirm:function(){var t={name:this.name};this.$emit("confirm",t)}},mounted:function(){var t=this;this.escHandler=function(e){27===e.keyCode&&t.show&&t.$emit("cancel")},document.addEventListener("keyup",this.escHandler,{passive:!0})},beforeDestroy:function(){document.removeEventListener("keyup",this.escHandler)},computed:{backClasses:function(){return["fixed","top-0","left-0","right-0","w-screen","h-screen","bg-gray-darken","transition-opacity-100","z-20"].concat(this.show?["pointer-events-auto","opacity-1"]:["pointer-events-none","opacity-0"])},parentClasses:function(){return["fixed","top-0","left-0","right-0","flex","justify-center","p-4","md:pt-16","h-auto","max-h-screen","pointer-events-none"]},sectionClasses:function(){return["w-full","sm:w-120","bg-gray-100","rounded-md","p-4","shadow-lg","flex","flex-col","justify-between"].concat(this.show?["pointer-events-auto"]:[])}}},c=o(13),component=Object(c.a)(r,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{ref:"back",class:t.backClasses,on:{click:t.cancelOnBack}},[o("div",{class:t.parentClasses},[o("section",{class:t.sectionClasses},[o("div",{ref:"scrollZone",staticClass:"overflow-y-auto max-h-full px-4 sm:px-6"},[o("h2",{staticClass:"text-center font-heading text-2xl my-3",domProps:{textContent:t._s(t.$t("pages.explore.bookmark.title"))}}),t._v(" "),o("p",{staticClass:"text-center mb-2",domProps:{textContent:t._s(t.$t("pages.explore.bookmark.explain"))}}),t._v(" "),o("div",{staticClass:"flex flex-col mb-8"},[o("h3",{staticClass:"font-bold text-lg mb-2",domProps:{textContent:t._s(t.$t("pages.explore.bookmark.name"))}}),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"name"}],staticClass:"flex-grow mx-2 py-2 transparent-input",attrs:{type:"text",placeholder:t.defaultChartName,name:"name-input",id:"name-input"},domProps:{value:t.name},on:{input:function(e){e.target.composing||(t.name=e.target.value)}}})]),t._v(" "),o("div",{staticClass:"flex flex-col mb-12 text-center"},[o("span",{domProps:{textContent:t._s(t.$t("pages.explore.bookmark.relative_period"))}}),t._v(" "),o("span",{staticClass:"mt-2 font-bold",domProps:{textContent:t._s(t.periodOffsetString)}})])]),t._v(" "),o("div",{staticClass:"flex mb-3"},[o("button",{staticClass:"flex-grow mr-3 action bg-gray-600 text-gray-100 text-center",domProps:{textContent:t._s(t.$t("global.cancel"))},on:{click:t.cancel}}),t._v(" "),o("button",{staticClass:"flex-grow ml-3 action bg-naito-green-200 text-gray-100 text-center",domProps:{textContent:t._s(t.$t("pages.explore.bookmark.confirm"))},on:{click:t.confirm}})])])])])}),[],!1,null,null,null);e.a=component.exports},190:function(t,e,o){"use strict";var n=o(5),r={name:"DownloadPopup",props:{show:Boolean},data:function(){return{format:"csv"}},watch:{show:function(t){t&&(Object(n.P)(this.$refs.scrollZone),this.format="csv")}},methods:{cancelOnBack:function(t){t.target===this.$refs.back&&this.$emit("cancel")},cancel:function(){this.$emit("cancel")},confirm:function(){var t={format:this.format};this.$emit("confirm",t)}},mounted:function(){var t=this;this.escHandler=function(e){27===e.keyCode&&t.show&&t.$emit("cancel")},document.addEventListener("keyup",this.escHandler,{passive:!0})},beforeDestroy:function(){document.removeEventListener("keyup",this.escHandler)},computed:{backClasses:function(){return["fixed","top-0","left-0","right-0","w-screen","h-screen","bg-gray-darken","transition-opacity-100","z-20"].concat(this.show?["pointer-events-auto","opacity-1"]:["pointer-events-none","opacity-0"])},parentClasses:function(){return["fixed","top-0","left-0","right-0","flex","justify-center","p-4","md:pt-16","h-auto","max-h-screen","pointer-events-none"]},sectionClasses:function(){return["w-full","sm:w-120","bg-gray-100","rounded-md","p-4","shadow-lg","flex","flex-col","justify-between"].concat(this.show?["pointer-events-auto"]:[])}}},c=o(13),component=Object(c.a)(r,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{ref:"back",class:t.backClasses,on:{click:t.cancelOnBack}},[o("div",{class:t.parentClasses},[o("section",{class:t.sectionClasses},[o("div",{ref:"scrollZone",staticClass:"overflow-y-auto max-h-full px-4 sm:px-6"},[o("h2",{staticClass:"text-center font-heading text-2xl my-3",domProps:{textContent:t._s(t.$t("pages.explore.download.title"))}}),t._v(" "),o("div",{staticClass:"flex flex-col mb-12"},[o("h3",{staticClass:"font-bold text-lg mb-2",domProps:{textContent:t._s(t.$t("pages.explore.download.format"))}}),t._v(" "),o("div",{staticClass:"flex items-center"},[o("label",{staticClass:"material-radio text-naito-green-200",attrs:{for:"format-csv-input"}},[o("input",{directives:[{name:"model",rawName:"v-model",value:t.format,expression:"format"}],attrs:{type:"radio",id:"format-csv-input",value:"csv",name:"format-input"},domProps:{checked:t._q(t.format,"csv")},on:{change:function(e){t.format="csv"}}}),t._v(" "),o("div",{staticClass:"material-radio-fake"})]),t._v(" "),o("label",{staticClass:"flex-grow select-none",attrs:{for:"format-csv-input"}},[t._v("CSV")])]),t._v(" "),o("div",{staticClass:"flex items-center"},[o("label",{staticClass:"material-radio text-naito-green-200",attrs:{for:"format-json-input"}},[o("input",{directives:[{name:"model",rawName:"v-model",value:t.format,expression:"format"}],attrs:{type:"radio",id:"format-json-input",value:"json",name:"format-input"},domProps:{checked:t._q(t.format,"json")},on:{change:function(e){t.format="json"}}}),t._v(" "),o("div",{staticClass:"material-radio-fake"})]),t._v(" "),o("label",{staticClass:"flex-grow select-none",attrs:{for:"format-json-input"}},[t._v("JSON")])])])]),t._v(" "),o("div",{staticClass:"flex mb-3"},[o("button",{staticClass:"flex-grow mr-3 action bg-gray-600 text-gray-100 text-center",domProps:{textContent:t._s(t.$t("global.cancel"))},on:{click:t.cancel}}),t._v(" "),o("button",{staticClass:"flex-grow ml-3 action bg-naito-green-200 text-gray-100 text-center",domProps:{textContent:t._s(t.$t("pages.explore.download.confirm"))},on:{click:t.confirm}})])])])])}),[],!1,null,null,null);e.a=component.exports},199:function(t,e,o){"use strict";o.r(e);o(54),o(20),o(41),o(19),o(66);var n=o(2),r=(o(14),o(10),o(36),o(27),o(4)),c=o(5),l=o(181);o(38),o(37),o(28),o(29),o(122),o(65),o(69),o(70);function d(t,e){var o;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=function(t,e){if(!t)return;if("string"==typeof t)return f(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return f(t,e)}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,c=!0,l=!1;return{s:function(){o=t[Symbol.iterator]()},n:function(){var t=o.next();return c=t.done,t},e:function(t){l=!0,r=t},f:function(){try{c||null==o.return||o.return()}finally{if(l)throw r}}}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,o=new Array(e);i<e;i++)o[i]=t[i];return o}var h={name:"SearchSelectMulti",props:{name:{type:String,required:!0},placeholder:{type:String,default:""},options:{type:Array,default:function(){return[]}},value:{type:Array,default:function(){return[]}},top:{type:Boolean,default:!1},single:{type:Boolean,default:!1}},data:function(){return{searchString:"",showOptions:!1,checked:[],mousedownListener:null}},watch:{options:function(t,e){if(0!==e.length){var o=t.map((function(option){return option.id}));this.checked=this.checked.filter((function(option){return o.includes(option)})),this.$emit("input",this.checked)}},value:function(t){JSON.stringify(t)!==JSON.stringify(this.checked)&&(this.showOptions=!1,this.checked=t)}},mounted:function(){var t=this;this.mousedownListener=function(){t.showOptions=!1},document.addEventListener("mousedown",this.mousedownListener,{passive:!0})},beforeDestroy:function(){this.mousedownListener&&document.removeEventListener("mousedown",this.mousedownListener)},methods:{keepShown:function(t){this.showOptions&&t.stopPropagation()},show:function(t){this.showOptions||(this.showOptions=!0,this.top&&Object(c.O)(this.$refs.scrollDiv))},checkForTab:function(t){var e=this;9===t.keyCode&&setTimeout((function(){e.$refs.focusRoot.contains(document.activeElement)||(e.showOptions=!1)}),0)},clear:function(){this.searchString="",this.$refs.focusRoot.getElementsByTagName("input")[0].focus()},clickedOption:function(option){var t=this.checked.indexOf(option.id);-1!==t?this.checked.splice(t,1):this.checked.push(option.id),this.$emit("input",this.checked)},toggleSelection:function(){this.anySelected?this.selectNone():this.selectAll()},selectAll:function(){var t,e=d(this.filteredOptions);try{for(e.s();!(t=e.n()).done;){var option=t.value;-1===this.checked.indexOf(option.id)&&this.checked.push(option.id)}}catch(t){e.e(t)}finally{e.f()}this.$emit("input",this.checked)},selectNone:function(){var t,e=d(this.filteredOptions);try{for(e.s();!(t=e.n()).done;){var option=t.value,o=this.checked.indexOf(option.id);-1!==o&&this.checked.splice(o,1)}}catch(t){e.e(t)}finally{e.f()}this.$emit("input",this.checked)}},computed:{inputName:function(){return"search-select-"+this.name},filteredOptions:function(){var t=this;return""===this.searchString?this.options.sort((function(a,b){return a.value.localeCompare(b.value)})):this.options.filter((function(option){return-1!==option.value.search(new RegExp(t.searchString,"gi"))})).sort((function(a,b){return a.value.localeCompare(b.value)}))},anySelected:function(){var t,e=d(this.filteredOptions);try{for(e.s();!(t=e.n()).done;){var option=t.value;if(this.checked.includes(option.id))return!0}}catch(t){e.e(t)}finally{e.f()}return!1},optionsClasses:function(){return["absolute","bg-gray-200","shadow-md","w-full","transition-opacity-100","flex"].concat(this.showOptions?["opacity-1","pointer-events-auto"]:["opacity-0","pointer-events-none"]).concat(this.top?["flex-col-reverse","bottom-full","rounded-t-md"]:["flex-col","rounded-b-md"])},optionsUlClasses:function(){return["flex"].concat(this.top?["flex-col-reverse"]:["flex-col"])},actionsClasses:function(){return["flex-grow","border-gray-300","flex"].concat(this.top?["border-b-2"]:["border-t-2"])},toggleClasses:function(){return["outline-action"].concat(this.anySelected?["text-gray-600"]:["text-naito-green-200"])},hasFilteredOptions:function(){return this.filteredOptions.length>0},selectAllNoneString:function(){return this.$t("global.select_".concat(this.anySelected?"none":"all").concat(""!==this.searchString?"_results":""))}}},m=o(13),v=Object(m.a)(h,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{ref:"focusRoot",staticClass:"relative z-10",on:{mousedown:t.keepShown}},[o("div",{class:"w-full flex items-center text-gray-900 relative "+(t.single?"wrapped-single-transparent-input":"wrapped-transparent-input")},[o("label",{staticClass:"material-icons py-2 pl-2 clickable",attrs:{for:t.inputName}},[t._v("search")]),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.searchString,expression:"searchString"}],staticClass:"flex-grow px-4 py-2",attrs:{placeholder:t.placeholder,type:"text",name:t.inputName,id:t.inputName},domProps:{value:t.searchString},on:{focus:t.show,keydown:t.checkForTab,input:function(e){e.target.composing||(t.searchString=e.target.value)}}}),t._v(" "),""!==t.searchString?o("i",{staticClass:"material-icons py-2 pr-2 clickable text-gray-800",on:{click:t.clear}},[t._v("backspace")]):t._e(),t._v(" "),o("div",{staticClass:"wrapped-style top-0 left-0 w-full h-full pointer-events-none absolute"})]),t._v(" "),o("div",{class:t.optionsClasses},[o("div",{ref:"scrollDiv",staticClass:"max-h-32 lg:max-h-64 overflow-y-auto"},[o("ul",{class:t.optionsUlClasses},[t._l(t.filteredOptions,(function(option){return o("li",{key:option.id,staticClass:"flex-grow flex"},[o("button",{staticClass:"p-4 w-full hover:bg-gray-100 flex items-center",attrs:{tabindex:t.showOptions?0:-1},on:{click:function(e){return t.clickedOption(option)},keydown:t.checkForTab}},[o("i",{staticClass:"material-icons select-none text-xl mr-2 text-naito-green-200",domProps:{textContent:t._s(t.checked.includes(option.id)?"check_box":"check_box_outline_blank")}}),t._v(" "),o("span",{domProps:{textContent:t._s(option.value)}})])])})),t._v(" "),t.hasFilteredOptions?t._e():o("li",{staticClass:"flex-grow p-4",domProps:{textContent:t._s(t.$t("global.no_results"))}})],2)]),t._v(" "),o("div",{class:t.actionsClasses},[t.hasFilteredOptions?o("button",{class:t.toggleClasses,attrs:{tabindex:t.showOptions?0:-1},on:{click:t.toggleSelection}},[o("i",{staticClass:"material-icons text-xl mr-4",domProps:{textContent:t._s(t.anySelected?"remove_circle_outline":"check_circle_outline")}}),t._v(" "),o("span",{staticClass:"mr-2",domProps:{textContent:t._s(t.selectAllNoneString)}})]):t._e(),t._v(" "),o("button",{staticClass:"clickable material-icons focus:shadow-outline hover:lighten-10 active:darken-10 p-4 text-xl ml-auto",attrs:{tabindex:t.showOptions?0:-1,title:t.$t("global.selector_close")},on:{keydown:t.checkForTab,click:function(e){t.showOptions=!1}}},[t._v("\n        close\n      ")])])])])}),[],!1,null,null,null).exports,y=o(188),x=o(189),w=o(190);function k(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(object);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,o)}return e}function C(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?k(Object(source),!0).forEach((function(e){Object(n.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):k(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var _={middleware:"needs-auth",head:function(){return{title:"".concat(this.$t("pages.explore.title")," - Meters"),htmlAttrs:{lang:this.$store.state.locale},meta:[{hid:"description",name:"description",content:this.$t("pages.explore.description")}]}},components:{AppHeader:l.a,SearchSelectMulti:v,BookmarkPopup:x.a,DownloadPopup:w.a,ExploreChart:y.a},data:function(){return{offset:0,agregation:0,period:0,resources:[],showBookmarkPopup:!1,showDownloadPopup:!1,currentData:null,hasData:!1,areSettingsCollapsed:!1}},mounted:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([t.$getResources(),t.$getResourceTypes()]);case 2:return t.getQuery(),0===t.resources.length&&t.$store.state.data.resources.length>0&&(t.resources=[t.$store.state.data.resources[0].id]),t.setQuery(),e.next=7,Promise.all([t.$getSensors(),t.$getSites(),t.$getUser()]);case 7:case"end":return e.stop()}}),e)})))()},methods:{navPopup:function(){this.$router.push({query:C(C({},this.$route.query),{},{popup:null})}).catch(c.A)},setQuery:function(){var t={path:Object(c.K)(this.$route.path),query:{offset:String(this.offset),agregation:c.L[this.agregation],period:c.M[this.period],resources:this.resources.map(String)}};JSON.stringify(t.query)!==JSON.stringify(this.$route.query)&&this.$router.replace(t).catch(c.A)},getQuery:function(){var t=this,e=this.$route.query,o=c.M.indexOf(e.period);-1!==o&&(this.period=o);var n=c.L.indexOf(e.agregation);-1!==n&&(this.agregation=n);var r=parseInt(e.offset);!isNaN(r)&&r>=0&&(this.offset=Math.min(r,365));var l=e.resources;if(Array.isArray(l))this.resources=l.map((function(t){return parseInt(t)})).filter((function(e){return!isNaN(e)&&void 0!==t.$store.state.dataById.resources[e]}));else{var d=parseInt(l);isNaN(d)||void 0===this.$store.state.dataById.resources[d]||(this.resources=[d])}},setCurrentData:function(t){var e=t.datasets,o=t.hasData;this.currentData=e,this.hasData=o},download:function(t){this.showDownloadPopup=!1,this.$router.go(-1);var e=Object(c.q)(this.currentData),o="",n="chart_period-".concat(c.M[this.period],"_offset-").concat(this.offset,"_agregation-").concat(c.L[this.agregation],"_resources-").concat(this.resources.join("-"));"json"===t.format?(o="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e,null,2)),n+=".json"):(o="data:text/csv;charset=utf-8,"+encodeURIComponent(Object(c.r)(e,this.$i18n)),n+=".csv"),this.$refs.downloader.setAttribute("href",o),this.$refs.downloader.setAttribute("download",n),this.$refs.downloader.click()},bookmark:function(t){var e=t.name;this.showBookmarkPopup=!1,this.$router.go(-1);var o={name:e,type:"explore",offset:this.offset,agregation:c.L[this.agregation],period:c.M[this.period],resources:this.resources};this.$store.commit("ADD_DASHBOARD_CHART",{element:o}),this.$putUser({dashboard:JSON.stringify(this.$store.getters.dashboard)},this.$t("api.dashboard_updated"),3e3)},toggleCollapse:function(t){this.areSettingsCollapsed=!this.areSettingsCollapsed,t.stopPropagation()}},watch:{offset:function(){this.setQuery()},agregation:function(){this.setQuery()},period:function(){this.setQuery()},resources:function(){this.setQuery()},$route:function(t){t.query.hasOwnProperty("popup")||(this.showBookmarkPopup&&(this.showBookmarkPopup=!1),this.showDownloadPopup&&(this.showDownloadPopup=!1))}},computed:{isLastPeriodOffset:function(){return 0===this.offset},reversePeriods:function(){return c.M},reverseAgregations:function(){return c.L},periodOffsetString:function(){return this.$tc("period_offsets."+c.M[this.period],this.offset,{count:this.offset})},formattedResources:function(){var t=this;return this.$store.getters.resources.map((function(e){var o=t.$store.getters.resourceType(e),n=null;if(t.$store.getters.numSites>1){var r=t.$store.getters.sensor(e);n=t.$store.getters.site(r)}return{id:e.id,value:Object(c.u)(t.$i18n,e,o,n)}}))},defaultChartName:function(){return 0===this.resources.length?"":this.$store.state.dataById.resources?Object(c.v)({offset:this.offset,period:c.M[this.period],resources:this.resources},this.$store.state.dataById.resources,this.$i18n):""}}},O=Object(m.a)(_,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"w-full"},[o("app-header",{attrs:{title:t.$t("pages.explore.title"),description:t.$t("pages.explore.description"),back:!0}}),t._v(" "),o("section",{staticClass:"relative bg-gray-100 rounded-md p-4 pt-2 md:p-6 md:pt-3 mb-48 mx-auto w-full lg:w-2/3 xl:w-3/5"},[o("explore-chart",{class:["chart-height-explore","transition-opacity-100",t.resources.length>0?"opacity-1":"opacity-0"],attrs:{period:t.period,agregation:t.agregation,offset:t.offset,resources:t.resources},on:{currentData:t.setCurrentData}}),t._v(" "),o("div",{class:["absolute","top-0","left-0","w-full","h-full","flex","items-center","justify-center","transition-opacity-100"].concat(t.resources.length>0?["opacity-0","pointer-events-none"]:["opacity-1","pointer-events-auto"])},[o("span",{staticClass:"text-center font-medium p-4",domProps:{textContent:t._s(t.$t("pages.explore.form.no_resources"))}})])],1),t._v(" "),o("section",{staticClass:"fixed bottom-0 inset-x-0 w-full p-4 md:px-1/5 lg:px-1/4 xl:px-1/3 bg-naito-green-200 shadow-lg-top"},[o("section",{staticClass:"absolute top-0 right-0 -mt-32 text-gray-100 rounded-l-md flex flex-col"},[o("button",{staticClass:"rounded-tl-md p-4 bg-naito-blue-300 simple-action",attrs:{title:t.$t("pages.explore.download.title"),disabled:!t.hasData},on:{click:function(e){t.showDownloadPopup=!0,t.navPopup()}}},[o("i",{staticClass:"material-icons text-xl"},[t._v("get_app")])]),t._v(" "),o("button",{staticClass:"rounded-bl-md p-4 bg-naito-blue-300 simple-action",attrs:{title:t.$t("pages.explore.bookmark.title"),disabled:0===t.resources.length},on:{click:function(e){t.showBookmarkPopup=!0,t.navPopup()}}},[o("i",{staticClass:"material-icons text-xl"},[t._v("bookmark")])])]),t._v(" "),o("button",{staticClass:"clickable material-icons absolute top-0 left-0 -mt-12 min-w-10 min-h-10 p-5 text-2xl bg-naito-green-200 rounded-t-full text-gray-100",attrs:{title:t.$t("pages.explore.collapse_settings")},domProps:{textContent:t._s(t.areSettingsCollapsed?"expand_less":"expand_more")},on:{click:function(e){return t.toggleCollapse(e)}}}),t._v(" "),o("div",{class:t.areSettingsCollapsed?"hidden":"block"},[o("search-select-multi",{attrs:{name:"resources",placeholder:t.$t("pages.explore.form.find_resources"),options:t.formattedResources,top:!0,single:!0},model:{value:t.resources,callback:function(e){t.resources=e},expression:"resources"}}),t._v(" "),o("div",{staticClass:"flex my-2"},[o("div",{staticClass:"w-1/2 mr-1 material-select"},[o("label",{attrs:{for:"agregation-input"},domProps:{textContent:t._s(t.$t("agregations.short"))}}),t._v(" "),o("select",{directives:[{name:"model",rawName:"v-model",value:t.agregation,expression:"agregation"}],attrs:{name:"agregation-input",id:"agregation-input"},on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.agregation=e.target.multiple?o:o[0]}}},t._l(t.reverseAgregations,(function(option,i){return o("option",{key:i,domProps:{value:i,textContent:t._s(t.$t("agregations."+option))}})})),0)]),t._v(" "),o("div",{staticClass:"w-1/2 ml-1 material-select"},[o("label",{attrs:{for:"period-input"},domProps:{textContent:t._s(t.$t("periods.short"))}}),t._v(" "),o("select",{directives:[{name:"model",rawName:"v-model",value:t.period,expression:"period"}],attrs:{name:"period-input",id:"period-input"},on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.period=e.target.multiple?o:o[0]}}},t._l(t.reversePeriods,(function(option,i){return o("option",{key:i,domProps:{value:i,textContent:t._s(t.$t("periods."+option))}})})),0)])]),t._v(" "),o("div",{staticClass:"flex justify-end items-center"},[o("span",{staticClass:"text-gray-100 font-bold mr-4",domProps:{textContent:t._s(t.periodOffsetString)}}),t._v(" "),o("button",{staticClass:"w-10 h-10 bg-gray-100 rounded-l-md simple-action",on:{click:function(e){t.offset++}}},[o("i",{staticClass:"material-icons text-2xl text-gray-800"},[t._v("arrow_left")])]),t._v(" "),o("button",{staticClass:"w-10 h-10 bg-gray-100 simple-action",attrs:{disabled:t.isLastPeriodOffset},on:{click:function(e){t.offset--}}},[o("i",{staticClass:"material-icons text-2xl text-gray-800"},[t._v("arrow_right")])]),t._v(" "),o("button",{staticClass:"w-10 h-10 bg-gray-100 rounded-r-md simple-action",attrs:{disabled:t.isLastPeriodOffset},on:{click:function(e){t.offset=0}}},[o("i",{staticClass:"material-icons text-lg text-gray-800"},[t._v("fast_forward")])])])],1)]),t._v(" "),o("bookmark-popup",{attrs:{show:t.showBookmarkPopup,periodOffsetString:t.periodOffsetString,defaultChartName:t.defaultChartName},on:{cancel:function(e){t.showBookmarkPopup=!1,t.$router.go(-1)},confirm:t.bookmark}}),t._v(" "),o("download-popup",{attrs:{show:t.showDownloadPopup},on:{cancel:function(e){t.showDownloadPopup=!1,t.$router.go(-1)},confirm:t.download}}),t._v(" "),o("a",{ref:"downloader",staticClass:"hidden"})],1)}),[],!1,null,null,null);e.default=O.exports}}]);