(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{181:function(t,e,n){"use strict";var o=n(5),r={props:{title:String,description:String,back:{type:Boolean,default:!0},url:{type:String,default:"/"}},methods:{goBack:function(t){t.preventDefault(),this.$router.push(this.url).catch(o.A)}}},l=n(13),component=Object(l.a)(r,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("header",{staticClass:"w-full flex items-center justify-center h-18"},[t.back?n("button",{staticClass:"z-20 clickable material-icons focus:shadow-outline hover:lighten-10 active:darken-10 absolute left-0 top-0 min-w-10 min-h-10 px-5 py-4 text-2xl",attrs:{title:t.$t("global.back")},on:{click:t.goBack}},[t._v("\n    arrow_back\n  ")]):n("img",{staticClass:"z-20 absolute left-0 top-0 w-10 mx-5 my-4 select-none",attrs:{src:"/images/naito-900.svg",alt:t.$t("alt.naito_one_logo")}}),t._v(" "),n("h1",{staticClass:"font-heading text-2xl",attrs:{title:t.description},domProps:{textContent:t._s(t.title)}})])}),[],!1,null,null,null);e.a=component.exports},206:function(t,e,n){"use strict";n.r(e);var o=n(34),r=(n(19),n(69),n(70),n(14),n(10),n(36),n(51)),l=(n(27),n(4)),c=n(11),m=n(181),d=n(91),f=n(5),x={middleware:"needs-auth",head:function(){return{title:"".concat(this.$t("pages.settings.title")," - Meters"),htmlAttrs:{lang:this.$store.state.locale},meta:[{hid:"description",name:"description",content:this.$t("pages.settings.description")}]}},components:{AppHeader:m.a,LanguageSelector:d.a},data:function(){return{loginUrl:"/login",details:null}},mounted:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.$store.getters.rememberMe&&(t.loginUrl="/login?remember-me"),t.details=Object(r.a)(t.$el.getElementsByTagName("details")),e.next=4,Promise.all([t.$getUser(),t.$getSensors(),t.$getResources(),t.$getResourceTypes(),t.$getSites(),t.$getClient(),t.$getSessions(!0)]);case 4:case"end":return e.stop()}}),e)})))()},methods:{saveUserLocale:function(t){this.$putUser(t)},isSubscribed:function(t){return this.sensorSubscriptions.includes(t)},toggleSubscribe:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){var o,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=e.sensorSubscriptions.indexOf(t),l=Object(r.a)(e.sensorSubscriptions),-1!==o?l.splice(o,1):l.push(t),n.prev=3,n.next=6,e.$putUser({sensor_subscriptions:JSON.stringify(l)},e.$t("api.sensor_subscriptions_updated"),6e3);case 6:e.$store.dispatch("updateSensorSubscriptions",{sensor_subscriptions:l}),n.next=11;break;case 9:n.prev=9,n.t0=n.catch(3);case 11:case"end":return n.stop()}}),n,null,[[3,9]])})))()},getFormattedSensorResources:function(t){var e=this,n=this.$store.getters.resources.filter((function(e){return e.sensor_id===t}));return 0===n.length?this.$t("pages.settings.sensor_subscriptions.no_associated_resources"):n.map((function(t){return Object(f.u)(e.$i18n,t,e.$store.getters.resourceType(t))})).join(", ")},logout:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.preventDefault(),n.prev=1,n.next=4,e.$post("/logout",{api_token:e.$store.state.apiToken});case 4:n.sent,n.next=10;break;case 7:n.prev=7,n.t0=n.catch(1),console.error(n.t0);case 10:e.$store.dispatch("logout"),e.$router.push(e.loginUrl);case 12:case"end":return n.stop()}}),n,null,[[1,7]])})))()},confirmDeleteSession:function(t,e){var n=this;return Object(l.a)(regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if("false"!==t.currentTarget.dataset.popupShow){o.next=4;break}t.currentTarget.dataset.popupShow="true",o.next=14;break;case 4:return t.currentTarget.dataset.popupShow="false",n.$store.dispatch("hideMessage"),o.prev=6,o.next=9,n.$delSession({id:e.id});case 9:o.next=13;break;case 11:o.prev=11,o.t0=o.catch(6);case 13:n.$getSessions(!0);case 14:case"end":return o.stop()}}),o,null,[[6,11]])})))()},toggleDetail:function(t){t.currentTarget.open&&this.details.forEach((function(e){e!==t.currentTarget&&e.open&&(e.open=!1)}))}},computed:{name:function(){return this.$store.getters.name},clientData:function(){var t=this.$numberLocale();return[{name:"pages.settings.infos.data.client_name",value:this.$store.getters.clientName},{name:"pages.settings.infos.data.client_number",value:this.$store.getters.clientNumber},{name:"global.email",value:this.$store.getters.clientEmail},{name:"pages.settings.infos.data.num_sensors",value:this.$store.getters.numResources.toLocaleString(t)},{name:"pages.settings.infos.data.num_sites",value:this.$store.getters.numSites.toLocaleString(t)}]},userData:function(){return[{name:"pages.settings.infos.data.user_name",value:this.$store.getters.name},{name:"global.email",value:this.$store.getters.email},{name:"pages.settings.infos.data.created_at",value:this.$store.getters.accountCreatedAt.setLocale(this.$dateLocale()).toLocaleString(c.DateTime.DATE_FULL)}]},userLocale:function(){return this.$store.getters.userLocale},locales:function(){return this.$store.state.locales},sensorSubscriptions:function(){return this.$store.getters.sensorSubscriptions},sensors:function(){return this.$store.getters.sensors},sessions:function(){return this.$store.getters.sessions},formattedSessions:function(){var t=this,e=c.DateTime.local(),n=e.toMillis();return this.sessions.map((function(t){return[null===t.expires_at?null:c.DateTime.fromISO(t.expires_at),t]})).filter((function(t){var e=Object(o.a)(t,1)[0];return!e||n<e.toMillis()})).map((function(n){var r=Object(o.a)(n,2),l=r[0],m=r[1],d=c.DateTime.fromISO(m.last_used_at);return[d.toMillis(),{id:m.id,browserImage:"/images/browsers/".concat(m.user_agent.browser,".svg"),browserAlt:m.user_agent.browser||t.$t("pages.settings.sessions.unknown_browser"),platformIcon:m.user_agent.is_mobile?"smartphone":"computer",description:m.user_agent.description,lastUsedAt:d.startOf("second").minus({second:2}).setLocale(t.$dateLocale()).toRelative({base:e,style:"short"}),expiresAt:l?l.startOf("second").plus({second:2}).setLocale(t.$dateLocale()).toRelative({base:e,style:"short"}):null,ipAddress:m.ip_address}]})).sort((function(a,b){return b[0]-a[0]})).map((function(t){return t[1]}))}}},h=n(13),component=Object(h.a)(x,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("app-header",{attrs:{title:t.$t("pages.settings.title"),description:t.$t("pages.settings.description"),back:!0}}),t._v(" "),n("section",{staticClass:"mb-8 flex flex-col items-center"},[n("a",{staticClass:"mb-4 w-5/6 sm:w-100 action bg-naito-blue-300 text-gray-100 text-center relative",attrs:{href:"mailto:support@naito.one"}},[n("i",{staticClass:"material-icons absolute left-0 m-4 top-0"},[t._v("contact_support")]),t._v(" "),n("span",{domProps:{textContent:t._s(t.$t("pages.settings.actions.support"))}})]),t._v(" "),n("a",{staticClass:"w-full sm:w-120 action bg-naito-green-200 text-gray-100 text-center relative",attrs:{href:t.loginUrl},on:{click:t.logout}},[n("i",{staticClass:"material-icons absolute left-0 m-4 top-0"},[t._v("launch")]),t._v(" "),n("span",{domProps:{textContent:t._s(t.$t("pages.settings.actions.logout"))}})])]),t._v(" "),n("details",{attrs:{open:"open"},on:{toggle:t.toggleDetail}},[n("summary",{staticClass:"bg-gray-100 rounded-md p-4 mb-2 md:mx-20 lg:w-200 lg:mx-auto clickable focus:shadow-outline hover:shadow-lg text-lg font-bold",domProps:{textContent:t._s(t.$t("pages.settings.infos.title"))}}),t._v(" "),n("section",{staticClass:"bg-gray-100 rounded-md p-4 mb-2 md:mx-20 lg:w-200 lg:mx-auto"},[n("h2",{staticClass:"text-lg font-bold mb-3",domProps:{textContent:t._s(t.$t("pages.settings.infos.client"))}}),t._v(" "),n("ul",t._l(t.clientData,(function(data,i){return n("li",{key:i,staticClass:"flex items-center my-1"},[n("p",{staticClass:"font-medium w-1/2 pr-2",domProps:{textContent:t._s(t.$t(data.name))}}),t._v(" "),n("p",{domProps:{textContent:t._s(data.value)}})])})),0)]),t._v(" "),n("section",{staticClass:"bg-gray-100 rounded-md p-4 mb-8 md:mx-20 lg:w-200 lg:mx-auto"},[n("h2",{staticClass:"text-lg font-bold mb-3",domProps:{textContent:t._s(t.$t("pages.settings.infos.user"))}}),t._v(" "),n("ul",[t._l(t.userData,(function(data,i){return n("li",{key:i,staticClass:"flex items-center my-1"},[n("p",{staticClass:"font-medium w-1/2 pr-2",domProps:{textContent:t._s(t.$t(data.name))}}),t._v(" "),n("p",{domProps:{textContent:t._s(data.value)}})])})),t._v(" "),n("li",{staticClass:"flex items-center mt-1"},[n("p",{staticClass:"font-medium w-1/2 pr-2",domProps:{textContent:t._s(t.$t("pages.settings.infos.data.locale"))}}),t._v(" "),n("language-selector",{attrs:{locale:t.userLocale,locales:t.locales,label:"global.set_locale",name:"backend"},on:{change:t.saveUserLocale}})],1),t._v(" "),n("li",[n("p",{staticClass:"text-gray-800 mb-1",domProps:{textContent:t._s(t.$t("pages.settings.infos.locale_explain"))}})])],2)])]),t._v(" "),n("details",{on:{toggle:t.toggleDetail}},[n("summary",{staticClass:"bg-gray-100 rounded-md p-4 mb-2 md:mx-20 lg:w-200 lg:mx-auto clickable focus:shadow-outline hover:shadow-lg text-lg font-bold",domProps:{textContent:t._s(t.$t("pages.settings.sensor_subscriptions.title"))}}),t._v(" "),n("section",{staticClass:"bg-gray-100 rounded-md mb-1 p-4 md:mx-20 lg:w-200 lg:mx-auto text-center"},[n("p",{staticClass:"text-center",domProps:{textContent:t._s(t.$t("pages.settings.sensor_subscriptions.details"))}})]),t._v(" "),n("ul",{staticClass:"flex flex-col items-center mb-8 md:mx-20 lg:w-200 lg:mx-auto"},t._l(t.sensors,(function(e,i){return n("li",{key:i,staticClass:"w-full my-1 flex justify-between items-center bg-gray-100 rounded-md hover:shadow-lg"},[n("label",{staticClass:"font-bold flex-grow p-4 clickable focus:shadow-outline flex items-center",attrs:{for:i+"-subscribe-input"}},[n("span",{staticClass:"font-mono uppercase",domProps:{textContent:t._s(""+e.name)}}),t._v(" "),n("span",{staticClass:"pl-4",domProps:{textContent:t._s(t.getFormattedSensorResources(e.id))}})]),t._v(" "),n("label",{staticClass:"material-checkbox text-naito-blue-300",attrs:{for:i+"-subscribe-input"}},[n("input",{attrs:{type:"checkbox",name:i+"-subscribe-input",id:i+"-subscribe-input"},domProps:{checked:t.isSubscribed(e.id)},on:{change:function(n){return t.toggleSubscribe(e.id)}}}),t._v(" "),n("div",{staticClass:"material-checkbox-fake material-checkbox-fake__large"})])])})),0)]),t._v(" "),n("details",{on:{toggle:t.toggleDetail}},[n("summary",{staticClass:"bg-gray-100 rounded-md p-4 mb-2 md:mx-20 lg:w-200 lg:mx-auto clickable focus:shadow-outline hover:shadow-lg text-lg font-bold",domProps:{textContent:t._s(t.$t("pages.settings.sessions.title"))}}),t._v(" "),n("ul",{staticClass:"flex flex-col items-center mb-8 md:mx-20 lg:w-200 lg:mx-auto"},t._l(t.formattedSessions,(function(e,i){return n("li",{key:i,staticClass:"w-full my-1 flex justify-between items-center bg-gray-100 rounded-md"},[n("div",{staticClass:"flex-grow pl-4 pt-4 flex flex-col"},[n("div",{staticClass:"flex flex-grow items-center pr-4"},[n("img",{staticClass:"h-6 mr-2 text-gray-100 select-none text-gray-900 font-bold",attrs:{src:e.browserImage,alt:e.browserAlt}}),t._v(" "),n("i",{staticClass:"material-icons text-2xl select-none",domProps:{textContent:t._s(e.platformIcon)}}),t._v(" "),n("span",{staticClass:"flex-grow text-sm text-right ml-2",domProps:{textContent:t._s(e.lastUsedAt)}}),t._v(" "),e.expiresAt?n("span",{staticClass:"ml-2 italic text-sm",domProps:{textContent:t._s(t.$t("pages.settings.sessions.expires")+" "+e.expiresAt)}}):t._e()]),t._v(" "),n("div",{staticClass:"flex mt-2"},[n("p",{staticClass:"flex flex-col text-sm flex-grow"},[n("span",{staticClass:"font-bold leading-tight",domProps:{textContent:t._s(e.description)}}),t._v(" "),n("span",{staticClass:"leading-tight",domProps:{textContent:t._s(e.ipAddress)}})]),t._v(" "),n("button",{staticClass:"flex items-center text-naito-blue-300 text-lg py-4 px-5 clickable focus:shadow-outline popup confirmable",attrs:{"data-popup-show":"false","data-popup-text":t.$t("global.no_undoing"),title:t.$t("pages.settings.sessions.delete")},on:{click:function(n){return t.confirmDeleteSession(n,e)},blur:function(t){t.currentTarget.dataset.popupShow="false"}}},[n("i",{staticClass:"material-icons"},[t._v("delete")])])])])])})),0)]),t._v(" "),n("section",{staticClass:"bg-gray-100 rounded-md mb-24 p-4 md:mx-20 lg:w-200 lg:mx-auto text-center"},[n("span",{domProps:{textContent:t._s(t.$t("copyright.meteo"))}}),t._v(" "),n("a",{staticClass:"green-link",attrs:{rel:"noreferrer",target:"_blank",href:"https://www.prevision-meteo.ch"}},[t._v("www.prevision-meteo.ch")])])],1)}),[],!1,null,null,null);e.default=component.exports}}]);