(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{181:function(e,t,r){"use strict";var n=r(5),o={props:{title:String,description:String,back:{type:Boolean,default:!0},url:{type:String,default:"/"}},methods:{goBack:function(e){e.preventDefault(),this.$router.push(this.url).catch(n.A)}}},c=r(13),component=Object(c.a)(o,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("header",{staticClass:"w-full flex items-center justify-center h-18"},[e.back?r("button",{staticClass:"z-20 clickable material-icons focus:shadow-outline hover:lighten-10 active:darken-10 absolute left-0 top-0 min-w-10 min-h-10 px-5 py-4 text-2xl",attrs:{title:e.$t("global.back")},on:{click:e.goBack}},[e._v("\n    arrow_back\n  ")]):r("img",{staticClass:"z-20 absolute left-0 top-0 w-10 mx-5 my-4 select-none",attrs:{src:"/images/naito-900.svg",alt:e.$t("alt.naito_one_logo")}}),e._v(" "),r("h1",{staticClass:"font-heading text-2xl",attrs:{title:e.description},domProps:{textContent:e._s(e.title)}})])}),[],!1,null,null,null);t.a=component.exports},182:function(e,t,r){"use strict";var n=r(7),o=r(30),c=r(39),l=r(123),h=r(67),d=r(17),f=r(53).f,m=r(68).f,v=r(15).f,y=r(183).trim,w=n.Number,x=w,_=w.prototype,C="Number"==c(r(90)(_)),$="trim"in String.prototype,S=function(e){var t=h(e,!1);if("string"==typeof t&&t.length>2){var r,n,o,c=(t=$?t.trim():y(t,3)).charCodeAt(0);if(43===c||45===c){if(88===(r=t.charCodeAt(2))||120===r)return NaN}else if(48===c){switch(t.charCodeAt(1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+t}for(var code,l=t.slice(2),i=0,d=l.length;i<d;i++)if((code=l.charCodeAt(i))<48||code>o)return NaN;return parseInt(l,n)}}return+t};if(!w(" 0o1")||!w("0b1")||w("+0x1")){w=function(e){var t=arguments.length<1?0:e,r=this;return r instanceof w&&(C?d((function(){_.valueOf.call(r)})):"Number"!=c(r))?l(new x(S(t)),r,w):S(t)};for(var k,j=r(12)?f(x):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),O=0;j.length>O;O++)o(x,k=j[O])&&!o(w,k)&&v(w,k,m(x,k));w.prototype=_,_.constructor=w,r(18)(n,"Number",w)}},183:function(e,t,r){var n=r(8),o=r(40),c=r(17),l=r(184),h="["+l+"]",d=RegExp("^"+h+h+"*"),f=RegExp(h+h+"*$"),m=function(e,t,r){var o={},h=c((function(){return!!l[e]()||"​"!="​"[e]()})),d=o[e]=h?t(v):l[e];r&&(o[r]=d),n(n.P+n.F*h,"String",o)},v=m.trim=function(e,t){return e=String(o(e)),1&t&&(e=e.replace(d,"")),2&t&&(e=e.replace(f,"")),e};e.exports=m},184:function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},185:function(e,t,r){"use strict";r(14),r(38),r(20),r(36),r(37),r(28),r(29),r(10),r(122),r(65),r(19),r(182);var n=r(5);function o(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,h=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return l=e.done,e},e:function(e){h=!0,o=e},f:function(){try{l||null==r.return||r.return()}finally{if(h)throw o}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}var l={name:"SearchSelect",props:{name:{type:String,required:!0},placeholder:{type:String,default:""},options:{type:Array,default:function(){return[]}},value:{type:Number,default:-1},top:{type:Boolean,default:!1},single:{type:Boolean,default:!1}},data:function(){return{searchString:"",showOptions:!1,currentValue:-1,supposedSearchString:"",mousedownListener:null}},watch:{value:function(e){if(e!==this.currentValue){var option=this.getOptionById(e);this.searchString=option?option.value:"",this.supposedSearchString=this.searchString,this.showOptions=!1,this.currentValue=e}},options:function(e,t){if(0!==t.length){if(e.length===t.length&&-1!==this.currentValue)return this.searchString=this.getOptionById(this.currentValue).value,void(this.supposedSearchString=this.searchString);this.searchString="",this.supposedSearchString=this.searchString,this.currentValue=-1,this.$emit("input",-1)}}},mounted:function(){var e=this;this.mousedownListener=function(){e.showOptions&&(e.showOptions=!1,e.searchString=e.supposedSearchString)},document.addEventListener("mousedown",this.mousedownListener,{passive:!0})},beforeDestroy:function(){this.mousedownListener&&document.removeEventListener("mousedown",this.mousedownListener)},methods:{getOptionById:function(e){var t,r=o(this.options);try{for(r.s();!(t=r.n()).done;){var option=t.value;if(option.id===e)return option}}catch(e){r.e(e)}finally{r.f()}return null},keepShown:function(e){this.showOptions&&e.stopPropagation()},show:function(e){this.showOptions||(this.showOptions=!0,this.top&&Object(n.O)(this.$refs.scrollDiv))},checkForTab:function(e){var t=this;9===e.keyCode&&setTimeout((function(){t.$refs.focusRoot.contains(document.activeElement)||(t.showOptions=!1,t.searchString=t.supposedSearchString)}),0)},clear:function(){this.searchString="",this.supposedSearchString=this.searchString,this.currentValue=-1,this.$emit("input",-1),this.$refs.focusRoot.getElementsByTagName("input")[0].focus()},clickedOption:function(option){this.searchString=option.value,this.supposedSearchString=this.searchString,this.showOptions=!1,this.currentValue=option.id,this.$emit("input",option.id)}},computed:{inputName:function(){return"search-select-"+this.name},filteredOptions:function(){var e=this;return""===this.searchString?this.options.sort((function(a,b){return a.value.localeCompare(b.value)})):this.options.filter((function(option){return-1!==option.value.search(new RegExp(e.searchString,"gi"))})).sort((function(a,b){return a.value.localeCompare(b.value)}))},optionsClasses:function(){return["absolute","bg-gray-200","shadow-md","w-full","transition-opacity-100","flex"].concat(this.showOptions?["opacity-1","pointer-events-auto"]:["opacity-0","pointer-events-none"]).concat(this.top?["flex-col-reverse","bottom-full","rounded-t-md"]:["flex-col","rounded-b-md"])},optionsUlClasses:function(){return["flex"].concat(this.top?["flex-col-reverse"]:["flex-col"])}}},h=r(13),component=Object(h.a)(l,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"focusRoot",staticClass:"relative z-10",on:{mousedown:e.keepShown}},[r("div",{class:"w-full flex items-center text-gray-900 relative "+(e.single?"wrapped-single-transparent-input":"wrapped-transparent-input")},[r("label",{staticClass:"material-icons py-2 pl-2 clickable",attrs:{for:e.inputName}},[e._v("search")]),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.searchString,expression:"searchString"}],staticClass:"flex-grow px-4 py-2",attrs:{placeholder:e.placeholder,type:"text",name:e.inputName,id:e.inputName},domProps:{value:e.searchString},on:{focus:e.show,keydown:e.checkForTab,input:function(t){t.target.composing||(e.searchString=t.target.value)}}}),e._v(" "),""!==e.searchString?r("i",{staticClass:"material-icons py-2 pr-2 clickable text-gray-800",on:{click:e.clear}},[e._v("backspace")]):e._e(),e._v(" "),r("div",{staticClass:"wrapped-style top-0 left-0 w-full h-full pointer-events-none absolute"})]),e._v(" "),r("div",{class:e.optionsClasses},[r("div",{ref:"scrollDiv",staticClass:"max-h-32 lg:max-h-64 overflow-y-auto"},[r("ul",{class:e.optionsUlClasses},[e._l(e.filteredOptions,(function(option){return r("li",{key:option.id,staticClass:"flex-grow flex"},[r("button",{staticClass:"p-4 w-full hover:bg-gray-100",attrs:{tabindex:e.showOptions?0:-1},domProps:{textContent:e._s(option.value)},on:{click:function(t){return e.clickedOption(option)},keydown:e.checkForTab}})])})),e._v(" "),0===e.filteredOptions.length?r("li",{staticClass:"flex-grow p-4",domProps:{textContent:e._s(e.$t("global.no_results"))}}):e._e()],2)])])])}),[],!1,null,null,null);t.a=component.exports},201:function(e,t,r){"use strict";r.r(t);r(14),r(10),r(36),r(27);var n=r(4),o=r(5),c=r(181),l=(r(19),r(11)),h={name:"ObjectivePopup",components:{SearchSelect:r(185).a},props:{show:Boolean,mode:String,current:Object},data:function(){return{type:"weekly",value:0,resource_id:-1,compareValue:0,decimalDefaultFormat:o.n}},watch:{show:function(e){e&&(Object(o.P)(this.$refs.scrollZone),this.editMode?(this.type=this.current.type,this.value=this.current.value,this.resource_id=this.current.resource_id):(this.type="weekly",this.value=0,this.resource_id=-1))},resource_id:function(){this.updateCompareValue().catch(console.error)},type:function(){this.updateCompareValue().catch(console.error)}},methods:{updateCompareValue:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,c,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(-1!==e.resource_id){t.next=3;break}return e.compareValue=0,t.abrupt("return");case 3:return r=l.DateTime.local(),n="weekly"===e.type?Object(o.E)(r):Object(o.D)(r),t.next=7,e.$getReadings(e.resource_id,n);case 7:if(c=t.sent,h=.93*("weekly"===e.type?168:720),!(c.length<h)){t.next=12;break}return e.compareValue=-1,t.abrupt("return");case 12:e.compareValue=c[c.length-1].value-c[0].value;case 13:case"end":return t.stop()}}),t)})))()},cancelOnBack:function(e){e.target===this.$refs.back&&this.$emit("cancel")},cancel:function(){this.$emit("cancel")},confirm:function(){var e={type:this.type,value:parseFloat(this.value),resource_id:this.resource_id};this.editMode&&(e.id=this.current.id),this.$emit("confirm",e)}},mounted:function(){var e=this;this.escHandler=function(t){27===t.keyCode&&e.show&&e.$emit("cancel")},document.addEventListener("keyup",this.escHandler,{passive:!0})},beforeDestroy:function(){document.removeEventListener("keyup",this.escHandler)},computed:{backClasses:function(){return["fixed","top-0","left-0","right-0","w-screen","h-screen","bg-gray-darken","transition-opacity-100","z-20"].concat(this.show?["pointer-events-auto","opacity-1"]:["pointer-events-none","opacity-0"])},parentClasses:function(){return["fixed","top-0","left-0","right-0","flex","justify-center","p-4","md:pt-16","h-auto","max-h-screen","pointer-events-none"]},sectionClasses:function(){return["w-full","sm:w-120","bg-gray-100","rounded-md","p-4","shadow-lg","flex","flex-col","justify-between"].concat(this.show?["pointer-events-auto"]:[])},resource:function(){return this.$store.getters.resource({resource_id:this.resource_id})},symbol:function(){var e=this.$store.getters.resourceType(this.resource);return e?e.symbol:""},editMode:function(){return"edit"===this.mode},compareString:function(){return this.$t("pages.objectives.form.".concat(this.type,"_compare"))},allResources:function(){var e=this;return this.$store.getters.resources.filter((function(t){var r=e.$store.getters.resourceType(t);return r&&"Temperature"!==r.name}))},formattedResources:function(){var e=this;return this.allResources.map((function(t){var r=e.$store.getters.resourceType(t),n=null;if(e.$store.getters.numSites>1){var c=e.$store.getters.sensor(t);n=e.$store.getters.site(c)}return{id:t.id,value:Object(o.u)(e.$i18n,t,r,n)}}))}}},d=r(13),f=Object(d.a)(h,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"back",class:e.backClasses,on:{click:e.cancelOnBack}},[r("div",{class:e.parentClasses},[r("section",{class:e.sectionClasses},[r("div",{ref:"scrollZone",staticClass:"overflow-y-auto max-h-full px-4 sm:px-6"},[r("h2",{staticClass:"text-center font-heading text-2xl my-3",domProps:{textContent:e._s(e.$t("pages.objectives.modes."+e.mode))}}),e._v(" "),r("div",{staticClass:"mb-8"},[r("h3",{staticClass:"font-bold text-lg mb-2",domProps:{textContent:e._s(e.$t("pages.objectives.form.resource"))}}),e._v(" "),r("search-select",{attrs:{name:"resource",placeholder:e.$t("pages.objectives.form.find_resource"),options:e.formattedResources},model:{value:e.resource_id,callback:function(t){e.resource_id=t},expression:"resource_id"}})],1),e._v(" "),r("div",{staticClass:"flex flex-col mb-12"},[r("h3",{staticClass:"font-bold text-lg mb-2",domProps:{textContent:e._s(e.$t("pages.objectives.form.objective"))}}),e._v(" "),r("div",{staticClass:"flex items-center"},[r("label",{staticClass:"material-radio text-naito-green-200",attrs:{for:"type-weekly-input"}},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.type,expression:"type"}],attrs:{type:"radio",id:"type-weekly-input",value:"weekly",name:"type-input"},domProps:{checked:e._q(e.type,"weekly")},on:{change:function(t){e.type="weekly"}}}),e._v(" "),r("div",{staticClass:"material-radio-fake"})]),e._v(" "),r("label",{staticClass:"flex-grow select-none",attrs:{for:"type-weekly-input"},domProps:{textContent:e._s(e.$t("pages.objectives.form.weekly"))}})]),e._v(" "),r("div",{staticClass:"flex items-center"},[r("label",{staticClass:"material-radio text-naito-green-200",attrs:{for:"type-monthly-input"}},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.type,expression:"type"}],attrs:{type:"radio",id:"type-monthly-input",value:"monthly",name:"type-input"},domProps:{checked:e._q(e.type,"monthly")},on:{change:function(t){e.type="monthly"}}}),e._v(" "),r("div",{staticClass:"material-radio-fake"})]),e._v(" "),r("label",{staticClass:"flex-grow select-none",attrs:{for:"type-monthly-input"},domProps:{textContent:e._s(e.$t("pages.objectives.form.monthly"))}})]),e._v(" "),r("div",{staticClass:"flex items-center text-gray-700"},[r("label",{staticClass:"w-1/2",domProps:{textContent:e._s(e.compareString)}}),e._v(" "),r("span",{staticClass:"text-right flex-grow mx-2",domProps:{textContent:e._s(-1===e.compareValue?e.$t("pages.objectives.form.not_enough_data"):e.compareValue.toLocaleString(e.$numberLocale(),e.decimalDefaultFormat))}}),e._v(" "),-1!==e.compareValue?r("span",{domProps:{textContent:e._s(e.symbol)}}):e._e()]),e._v(" "),r("div",{staticClass:"flex items-center"},[r("label",{staticClass:"w-1/2 select-none",attrs:{for:"value-input"},domProps:{textContent:e._s(e.$t("pages.objectives.form.value"))}}),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"value"}],staticClass:"text-right flex-grow mx-2 py-2 transparent-input",attrs:{type:"number",min:"0",max:"9999999999.9",step:"0.1",name:"value-input",id:"value-input"},domProps:{value:e.value},on:{input:function(t){t.target.composing||(e.value=t.target.value)}}}),e._v(" "),r("span",{domProps:{textContent:e._s(e.symbol)}})])])]),e._v(" "),r("div",{staticClass:"flex mb-3"},[r("button",{staticClass:"flex-grow mr-3 action bg-gray-600 text-gray-100 text-center",domProps:{textContent:e._s(e.$t("global.cancel"))},on:{click:e.cancel}}),e._v(" "),r("button",{staticClass:"flex-grow ml-3 action bg-naito-green-200 text-gray-100 text-center",attrs:{disabled:-1===e.resource_id,title:-1===e.resource_id?e.$t("pages.objectives.form.missing_resource"):""},domProps:{textContent:e._s(e.$t("global.confirm"))},on:{click:e.confirm}})])])])])}),[],!1,null,null,null).exports,m={middleware:"needs-auth",head:function(){return{title:"".concat(this.$t("pages.objectives.title")," - Meters"),htmlAttrs:{lang:this.$store.state.locale},meta:[{hid:"description",name:"description",content:this.$t("pages.objectives.description")}]}},components:{AppHeader:c.a,ObjectivePopup:f},mounted:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([e.$getResources(),e.$getObjectives(),e.$getResourceTypes(),e.$getSensors(),e.$getSites()]);case 2:case"end":return t.stop()}}),t)})))()},data:function(){return{mode:"create",id:-1,show:!1}},watch:{$route:function(e){!e.query.hasOwnProperty("popup")&&this.show&&(this.show=!1)}},methods:{navPopup:function(){this.$router.push({query:{popup:null}}).catch(o.A)},create:function(){this.$store.dispatch("hideMessage"),this.mode="create",this.show=!0,this.navPopup()},update:function(e){this.$store.dispatch("hideMessage"),this.mode="edit",this.id=e,this.show=!0,this.navPopup()},del:function(e){this.$store.dispatch("hideMessage"),this.$delObjective({id:e})},confirmDelete:function(e,t){"false"===e.currentTarget.dataset.popupShow?e.currentTarget.dataset.popupShow="true":(e.currentTarget.dataset.popupShow="false",this.del(t.id))},popupCancel:function(){this.show=!1,this.$router.go(-1)},popupConfirm:function(e){this.show=!1,this.$router.go(-1),void 0!==e.id?this.$putObjective(e):this.$postObjective(e)}},computed:{objectives:function(){var e=this,t=this.$numberLocale();return this.$store.getters.objectives.map((function(r){var n={id:r.id,value:""},c=e.$store.getters.resource(r);if(null===c)return n;var l=e.$store.getters.resourceType(c);if(null===l)return n;var h=Object(o.u)(e.$i18n,c,l),d=e.$t("features.objective_types."+r.type),f=Object(o.U)(r.value);return n.value="".concat(h,", ").concat(f.number.toLocaleString(t,o.n)," ").concat(f.unit+l.symbol,"/").concat(d),n}))}}},v=Object(d.a)(m,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("app-header",{attrs:{title:e.$t("pages.objectives.title"),description:e.$t("pages.objectives.description"),back:!0}}),e._v(" "),r("p",{staticClass:"font-medium text-center mb-6",domProps:{textContent:e._s(e.$t("pages.objectives.info"))}}),e._v(" "),r("ul",{staticClass:"flex flex-col items-center"},e._l(e.objectives,(function(t,i){return r("li",{key:i,staticClass:"w-full lg:w-200 my-1 flex justify-between bg-gray-100 rounded-md hover:shadow-lg"},[r("button",{staticClass:"font-bold flex-grow py-4 pl-4 clickable focus:shadow-outline flex items-center",attrs:{title:e.$t("pages.objectives.modes.edit")},on:{click:function(r){return e.update(t.id)}}},[r("span",{staticClass:"flex-grow",domProps:{textContent:e._s(t.value)}}),e._v(" "),r("i",{staticClass:"material-icons text-naito-blue-300 text-lg px-5"},[e._v("edit")])]),e._v(" "),r("button",{staticClass:"flex items-center text-naito-blue-300 text-lg py-4 px-5 clickable focus:shadow-outline popup confirmable",attrs:{"data-popup-show":"false","data-popup-text":e.$t("global.no_undoing"),title:e.$t("pages.objectives.modes.delete")},on:{click:function(r){return e.confirmDelete(r,t)},blur:function(e){e.currentTarget.dataset.popupShow="false"}}},[r("i",{staticClass:"material-icons"},[e._v("delete")])])])})),0),e._v(" "),r("div",{staticClass:"mt-4 mb-24 md:mt-8 flex justify-center"},[r("button",{staticClass:"w-full lg:w-200 action bg-naito-blue-300 text-gray-100 text-center relative",on:{click:e.create}},[r("i",{staticClass:"material-icons absolute left-0 m-4 top-0"},[e._v("add")]),e._v(" "),r("span",{domProps:{textContent:e._s(e.$t("pages.objectives.modes.create"))}})])]),e._v(" "),r("objective-popup",{attrs:{show:e.show,mode:e.mode,current:e.$store.getters.objective({objective_id:e.id})},on:{cancel:e.popupCancel,confirm:e.popupConfirm}})],1)}),[],!1,null,null,null);t.default=v.exports}}]);